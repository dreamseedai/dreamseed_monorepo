# ExternalSecret for all R services
# This manifest creates secrets for R Forecast and R BRMS services from GCP Secret Manager

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: r-forecast-credentials
  namespace: seedtest
  labels:
    app: r-forecast-plumber
    component: analytics
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: r-forecast-credentials
    creationPolicy: Owner
  data:
  - secretKey: token
    remoteRef:
      key: r-forecast-internal-token

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: r-brms-credentials
  namespace: seedtest
  labels:
    app: r-brms-plumber
    component: analytics
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: r-brms-credentials
    creationPolicy: Owner
  data:
  - secretKey: token
    remoteRef:
      key: r-brms-internal-token

---
# Note: This assumes ClusterSecretStore 'gcp-secret-store' already exists
# If not, create it first:
#
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: gcp-secret-store
# spec:
#   provider:
#     gcpsm:
#       projectId: univprepai
#       auth:
#         secretRef:
#           secretAccessKeySecretRef:
#             name: eso-gcp-credentials
#             key: secret-access-key
#             namespace: seedtest
