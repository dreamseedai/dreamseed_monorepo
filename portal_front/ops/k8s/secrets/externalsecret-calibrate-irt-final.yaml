# cSpell:ignore externalsecrets
# ExternalSecret configuration for calibrate-irt CronJob (FINAL VERSION)
#
# This configuration integrates with existing secrets:
# - seedtest-db-credentials (DATABASE_URL)
# - r-irt-credentials (R_IRT_INTERNAL_TOKEN)
#
# Usage:
# 1. Apply ClusterSecretStore (if not exists)
# 2. Update remoteRef.key paths to match your GSM secret paths
# 3. Apply this ExternalSecret
# 4. Verify: kubectl -n seedtest get secret calibrate-irt-credentials
# 5. Update CronJob: kubectl apply -f ../cron/calibrate-irt-with-externalsecret.yaml

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: calibrate-irt-credentials
  namespace: seedtest
spec:
  refreshInterval: "1h"
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: calibrate-irt-credentials
    creationPolicy: Owner
    template:
      type: Opaque
  data:
    # Database URL (from existing seedtest-db-credentials pattern)
    - secretKey: DATABASE_URL
      remoteRef:
        key: seedtest/database-url
        # GSM path: projects/univprepai/secrets/seedtest-database-url/versions/latest
    
    # R IRT Plumber internal token (from existing r-irt-credentials pattern)
    - secretKey: R_IRT_INTERNAL_TOKEN
      remoteRef:
        key: r-irt-plumber/token
        # GSM path: projects/univprepai/secrets/r-irt-plumber-token/versions/latest
        version: latest

---
# Alternative: Use existing secrets directly (no ExternalSecret)
#
# If you prefer to use existing secrets (seedtest-db-credentials, r-irt-credentials),
# use the original CronJob: calibrate-irt.yaml
#
# No ExternalSecret needed in this case.

