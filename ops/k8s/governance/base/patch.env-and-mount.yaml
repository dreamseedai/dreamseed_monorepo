apiVersion: apps/v1
kind: Deployment
metadata:
  name: seedtest-api
spec:
  template:
    metadata:
      annotations:
        # (옵션) Stakater Reloader 사용 시 ConfigMap 변경 감지
        reloader.stakater.com/auto: "true"
    spec:
      volumes:
        - name: governance-bundles
          configMap:
            name: governance-bundles   # 해시가 붙은 실제 이름으로 kustomize가 대체
      containers:
        - name: seedtest-api
          env:
            - name: POLICY_BUNDLE_ID
              value: "phase1"          # overlays에서 덮어씁니다
            - name: GOVERNANCE_PHASE
              value: "1"
            - name: POLICY_STRICT_MODE
              value: "soft"            # dev/staging은 soft 권장
            - name: POLICY_BUNDLE_PATH
              value: "/app/governance/compiled/policy_bundle_phase1.json"
            - name: POLICY_HOT_RELOAD_ENABLED
              value: "true"
          volumeMounts:
            - name: governance-bundles
              mountPath: /app/governance/compiled
              readOnly: true
