name: Repository Cleanup Check

on:
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ (KST)
    - cron: '0 0 * * 1'
  workflow_dispatch:

jobs:
  cleanup-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check for orphaned files
        run: |
          echo "=== ë£¨íŠ¸ ë””ë ‰í† ë¦¬ íŒŒì¼ ì²´í¬ ==="
          file_count=$(ls -1 *.{py,sh,md,txt,ini,yml,yaml,json,sql,log,db} 2>/dev/null | wc -l)
          echo "ë£¨íŠ¸ íŒŒì¼ ê°œìˆ˜: $file_count"
          
          if [ $file_count -gt 10 ]; then
            echo "âš ï¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— íŒŒì¼ì´ ë„ˆë¬´ ë§ŽìŠµë‹ˆë‹¤ ($file_countê°œ)"
            echo "ì •ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤."
            exit 1
          fi
          
      - name: Check for large log files
        run: |
          echo "=== ëŒ€ìš©ëŸ‰ ë¡œê·¸ íŒŒì¼ ì²´í¬ ==="
          find . -name "*.log" -size +10M -exec ls -lh {} \;
          
      - name: Check for orphaned directories
        run: |
          echo "=== ë¹ˆ ë””ë ‰í† ë¦¬ ì²´í¬ ==="
          find . -type d -empty | head -20
          
      - name: Generate cleanup report
        if: failure()
        run: |
          echo "# ðŸ§¹ ì •ë¦¬ í•„ìš” ë¦¬í¬íŠ¸" > cleanup-report.md
          echo "" >> cleanup-report.md
          echo "## ë£¨íŠ¸ íŒŒì¼ ëª©ë¡" >> cleanup-report.md
          ls -lh *.{py,sh,md,txt,log} 2>/dev/null >> cleanup-report.md || true
          echo "" >> cleanup-report.md
          echo "## ë¹ˆ ë””ë ‰í† ë¦¬" >> cleanup-report.md
          find . -type d -empty >> cleanup-report.md
          
      - name: Upload report
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: cleanup-report
          path: cleanup-report.md
