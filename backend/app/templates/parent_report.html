<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DreamSeedAI 학습 리포트 – {{ student_name }}</title>
  <style>
    /* PDF용 최적화 스타일 */
    @page {
      size: A4;
      margin: 2cm 1.5cm;
    }
    
    body {
      font-family: 'Noto Sans KR', 'Arial', sans-serif;
      font-size: 11pt;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
    }
    
    /* 헤더 */
    header {
      text-align: center;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 1cm;
      margin-bottom: 1cm;
    }
    
    header h1 {
      font-size: 24pt;
      font-weight: bold;
      color: #1e40af;
      margin: 0 0 0.3cm 0;
    }
    
    header h2 {
      font-size: 16pt;
      font-weight: normal;
      color: #6b7280;
      margin: 0 0 0.5cm 0;
    }
    
    header p {
      font-size: 10pt;
      color: #4b5563;
      line-height: 1.8;
      margin: 0;
    }
    
    header strong {
      color: #1f2937;
      font-weight: 600;
    }
    
    /* 섹션 */
    section {
      margin-bottom: 1cm;
      page-break-inside: avoid;
    }
    
    section h3 {
      font-size: 14pt;
      font-weight: bold;
      color: #1e40af;
      border-bottom: 2px solid #dbeafe;
      padding-bottom: 0.2cm;
      margin: 0.5cm 0 0.3cm 0;
    }
    
    section p {
      margin: 0.3cm 0;
      text-align: justify;
    }
    
    /* 테이블 */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.5cm 0;
      font-size: 10pt;
    }
    
    thead {
      background-color: #dbeafe;
      color: #1e40af;
    }
    
    thead th {
      padding: 0.3cm 0.2cm;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #2563eb;
    }
    
    tbody tr {
      border-bottom: 1px solid #e5e7eb;
    }
    
    tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }
    
    tbody td {
      padding: 0.25cm 0.2cm;
      vertical-align: middle;
    }
    
    /* 변화 화살표 */
    .delta-up {
      color: #16a34a;
      font-weight: bold;
    }
    
    .delta-down {
      color: #dc2626;
      font-weight: bold;
    }
    
    .delta-neutral {
      color: #6b7280;
    }
    
    /* 위험도 배지 */
    .risk-low {
      display: inline-block;
      padding: 0.1cm 0.3cm;
      background-color: #dcfce7;
      color: #166534;
      border-radius: 0.2cm;
      font-size: 9pt;
      font-weight: 600;
    }
    
    .risk-medium {
      display: inline-block;
      padding: 0.1cm 0.3cm;
      background-color: #fef3c7;
      color: #92400e;
      border-radius: 0.2cm;
      font-size: 9pt;
      font-weight: 600;
    }
    
    .risk-high {
      display: inline-block;
      padding: 0.1cm 0.3cm;
      background-color: #fee2e2;
      color: #991b1b;
      border-radius: 0.2cm;
      font-size: 9pt;
      font-weight: 600;
    }
    
    /* 그래프 */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0.5cm auto;
      border: 1px solid #e5e7eb;
      border-radius: 0.3cm;
    }
    
    /* 리스트 */
    ul {
      margin: 0.3cm 0;
      padding-left: 0.8cm;
    }
    
    ul li {
      margin: 0.2cm 0;
    }
    
    /* 영문 설명 (보조) */
    .english-note {
      margin-top: 0.3cm;
      font-size: 9pt;
      color: #6b7280;
      font-style: italic;
    }
    
    /* 구분선 */
    hr {
      border: none;
      border-top: 1px solid #d1d5db;
      margin: 0.5cm 0;
    }
    
    /* 페이지 넘버 (프린트 시) */
    @media print {
      .page-break {
        page-break-before: always;
      }
    }
  </style>
</head>
<body>

<!-- ========================================================================= -->
<!-- 1. 표지 / 헤더 -->
<!-- ========================================================================= -->
<header>
  <h1>DreamSeedAI 학습 리포트</h1>
  <h2>Student Learning Report</h2>
  <p>
    학생 이름 (Student): <strong>{{ student_name }}</strong><br/>
    {% if school %}학교 (School): {{ school }}<br/>{% endif %}
    {% if grade %}학년 (Grade): {{ grade }}<br/>{% endif %}
    리포트 기간 (Period): <strong>{{ period_start }} ~ {{ period_end }}</strong><br/>
    생성일 (Generated at): {{ generated_at }}
  </p>
</header>

<hr/>

<!-- ========================================================================= -->
<!-- 2. 전체 요약 (부모용 자연어 요약) -->
<!-- ========================================================================= -->
<section>
  <h3>1. 전체 요약 Summary</h3>
  <p>
    {{ parent_friendly_summary_ko }}
  </p>
  <p class="english-note">
    English Summary:<br/>
    {{ parent_friendly_summary_en }}
  </p>
</section>

<!-- ========================================================================= -->
<!-- 3. 과목별 성취도 테이블 -->
<!-- ========================================================================= -->
<section>
  <h3>2. 과목별 현재 수준 Current Level by Subject</h3>
  <table>
    <thead>
      <tr>
        <th>과목<br/><span style="font-size:9pt;font-weight:normal;">Subject</span></th>
        <th>수준 (Band)<br/><span style="font-size:9pt;font-weight:normal;">Level</span></th>
        <th>백분위<br/><span style="font-size:9pt;font-weight:normal;">Percentile</span></th>
        <th>최근 변화 (4주)<br/><span style="font-size:9pt;font-weight:normal;">Δθ</span></th>
        <th>위험도<br/><span style="font-size:9pt;font-weight:normal;">Risk</span></th>
      </tr>
    </thead>
    <tbody>
      {% for subj in subjects %}
      <tr>
        <td>
          <strong>{{ subj.subject_label_ko }}</strong><br/>
          <span style="font-size:9pt;color:#6b7280;">{{ subj.subject_label_en }}</span>
        </td>
        <td>
          <strong>{{ subj.theta_band }}</strong><br/>
          <span style="font-size:9pt;color:#6b7280;">(θ = {{ "%.2f"|format(subj.theta) }})</span>
        </td>
        <td style="text-align:center;">
          <strong>{{ subj.percentile }}%</strong><br/>
          <span style="font-size:9pt;color:#6b7280;">상위 {{ 100 - subj.percentile }}%</span>
        </td>
        <td style="text-align:center;">
          {% if subj.delta_theta_4w is not none %}
            {% if subj.delta_theta_4w > 0.05 %}
              <span class="delta-up">
                {{ "+%.2f"|format(subj.delta_theta_4w) }} ↑
              </span>
            {% elif subj.delta_theta_4w < -0.05 %}
              <span class="delta-down">
                {{ "%.2f"|format(subj.delta_theta_4w) }} ↓
              </span>
            {% else %}
              <span class="delta-neutral">
                {{ "%.2f"|format(subj.delta_theta_4w) }} →
              </span>
            {% endif %}
          {% else %}
            <span style="color:#9ca3af;">N/A</span>
          {% endif %}
        </td>
        <td>
          {% if subj.risk_label_ko == "안정적" %}
            <span class="risk-low">{{ subj.risk_label_ko }}</span><br/>
            <span style="font-size:8pt;color:#6b7280;">{{ subj.risk_label_en }}</span>
          {% elif subj.risk_label_ko == "보통" %}
            <span class="risk-medium">{{ subj.risk_label_ko }}</span><br/>
            <span style="font-size:8pt;color:#6b7280;">{{ subj.risk_label_en }}</span>
          {% else %}
            <span class="risk-high">{{ subj.risk_label_ko }}</span><br/>
            <span style="font-size:8pt;color:#6b7280;">{{ subj.risk_label_en }}</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <p style="font-size:9pt;color:#6b7280;margin-top:0.3cm;">
    * θ (theta) = IRT 능력 추정치 (평균 0, 표준편차 1)<br/>
    * Δθ = 최근 4주간 능력 변화량 (양수 = 향상, 음수 = 하락)
  </p>
</section>

<!-- ========================================================================= -->
<!-- 4. 그래프 요약 (이미지로 삽입) -->
<!-- ========================================================================= -->
<section>
  <h3>3. 최근 추이 Recent Trend</h3>
  <p>
    아래 그래프는 최근 4~8주간의 실력 변화를 보여줍니다.<br/>
    <span class="english-note">
      The chart below shows learning progress over the last 4-8 weeks.
    </span>
  </p>
  <img src="{{ trend_chart_url }}" alt="Learning progress chart" />
  <p style="font-size:9pt;color:#6b7280;text-align:center;">
    실선: θ (능력 추정치) / 음영: 신뢰구간 (θ ± SE)<br/>
    Solid line: θ (ability estimate) / Shaded: confidence interval (θ ± SE)
  </p>
</section>

<!-- ========================================================================= -->
<!-- 5. 선생님/튜터 코멘트 -->
<!-- ========================================================================= -->
<section>
  <h3>4. 선생님/튜터 코멘트 Teacher/Tutor Comments</h3>
  <p>
    {{ teacher_comment_ko }}
  </p>
  <p class="english-note">
    English Comment:<br/>
    {{ teacher_comment_en }}
  </p>
</section>

<!-- ========================================================================= -->
<!-- 6. 다음 4주 계획 -->
<!-- ========================================================================= -->
<section>
  <h3>5. 다음 4주 계획 Next 4 Weeks Plan</h3>
  <p style="font-weight:600;margin-bottom:0.2cm;">한국어 계획:</p>
  <ul>
    {% for plan in next_plans_ko %}
    <li>{{ plan }}</li>
    {% endfor %}
  </ul>
  <p style="font-weight:600;margin-top:0.5cm;margin-bottom:0.2cm;font-size:10pt;color:#6b7280;">
    English Plan:
  </p>
  <ul class="english-note">
    {% for plan in next_plans_en %}
    <li>{{ plan }}</li>
    {% endfor %}
  </ul>
</section>

<!-- ========================================================================= -->
<!-- 7. 부모님을 위한 안내 -->
<!-- ========================================================================= -->
<section>
  <h3>6. 부모님을 위한 안내 Guidance for Parents</h3>
  <p>
    {{ parent_guidance_ko }}
  </p>
  <p class="english-note">
    English Guidance:<br/>
    {{ parent_guidance_en }}
  </p>
</section>

<!-- ========================================================================= -->
<!-- 푸터 -->
<!-- ========================================================================= -->
<hr style="margin-top:1cm;"/>
<footer style="text-align:center;font-size:9pt;color:#9ca3af;margin-top:0.5cm;">
  <p>
    이 리포트는 DreamSeedAI IRT/CAT 시스템에서 자동 생성되었습니다.<br/>
    This report was auto-generated by DreamSeedAI IRT/CAT system.<br/>
    <br/>
    문의: support@dreamseedai.com | © 2025 DreamSeedAI. All rights reserved.
  </p>
</footer>

</body>
</html>
