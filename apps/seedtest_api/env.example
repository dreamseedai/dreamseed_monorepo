# SeedTest API - Local Development Environment Configuration
# Copy this file to .env and adjust values for your setup

# ===== Core Settings =====
APP_ENV=local
API_PREFIX=/api/seedtest

# ===== Database =====
# PostgreSQL connection string (SQLAlchemy format)
DATABASE_URL=postgresql+psycopg2://user:pass@localhost:5432/dreamseed_db
# Example for local Docker: postgresql+psycopg2://user:pass@127.0.0.1:5432/dreamseed_db

# ===== Authentication (JWT) =====
# Option 1: JWKS URL (recommended for production)
JWKS_URL=https://auth.dreamseedai.com/.well-known/jwks.json
JWT_ISS=https://auth.dreamseedai.com/
JWT_AUD=seedtest-api

# Option 2: Direct public key (PEM format, multiline OK)
# JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"

# Local dev: skip JWT verification (WARNING: dev only!)
LOCAL_DEV=true

# ===== CAT (Computerized Adaptive Testing) Parameters =====
# Prior distribution
CAT_PRIOR_MEAN=0.0
CAT_PRIOR_SD=1.0

# Bayesian update constraints
CAT_STEP_CAP=1.0

# Selection criterion: FISHER (default) or KL
CAT_CRITERION=FISHER
CAT_KL_DELTA=0.5

# Selection policy
CAT_TOP_N=3                    # Randomesque top-N items
CAT_AVOID_REPEAT_K=2          # Avoid same topic for last K items
CAT_REPEAT_PENALTY=0.15       # 15% penalty for topic repetition
# CAT_BLUEPRINT={"1": 0.3, "2": 0.4, "3": 0.3}  # JSON: topic_id -> proportion
# CAT_MAX_EXPOSURE=50          # Max times an item can be selected

# Stopping rules
CAT_MODE=VARIABLE             # VARIABLE or FIXED
CAT_SEM_THRESHOLD=0.3         # Stop when SE < threshold (variable mode)
CAT_MIN_ITEMS=10              # Minimum items before SE stop allowed
CAT_MAX_ITEMS=30              # Hard cap on total items
CAT_MAX_TIME_SECONDS=1800     # 30 minutes

# Starting item randomization
CAT_START_RANDOMIZED=true
CAT_START_BAND_WIDTH=0.5      # +/- around theta0
CAT_START_TOP_N=3

# Content balancing
CAT_AVOID_SAME_TOPIC_HARD=true
CAT_SAME_TOPIC_TOLERANCE=0.05

# ===== Item Bank Filters =====
# Filter by subject, difficulty range, org, topics, tags
# BANK_SUBJECT=mathematics
# BANK_DIFF_MIN=-2.0
# BANK_DIFF_MAX=2.0
# BANK_ORG_ID=1
# BANK_TOPIC_IDS=1,2,3,5      # Comma-separated topic IDs
# BANK_TAGS=algebra,geometry  # Comma-separated tags

# Subsampling (optional)
# BANK_SAMPLE_K=100           # Sample K items
# BANK_SAMPLE_P=0.5           # Sample 50% of items

# Tags re-detection TTL (seconds, 0=always re-detect)
TAGS_KIND_TTL_SEC=300

# ===== Monitoring & Logging =====
# Sentry (optional)
# SENTRY_DSN=https://...@sentry.io/...
# SENTRY_ENV=local
# SENTRY_TRACES_SAMPLE_RATE=0.0
# SENTRY_PROFILES_SAMPLE_RATE=0.0

# Exposure logging path (optional)
# CAT_EXPOSURE_LOG_PATH=/tmp/cat_exposure.jsonl

# ===== Testing =====
# Enable integration tests (requires Docker Compose for DB)
RUN_INTEGRATION_TESTS=0       # Set to 1 to run integration tests locally

