<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamSeed AI Editor - TipTap + MathJax + ChemDoodle</title>
    
    <!-- TipTap Editor -->
    <script src="https://unpkg.com/@tiptap/core@2.1.13/dist/index.umd.min.js"></script>
    <script src="https://unpkg.com/@tiptap/starter-kit@2.1.13/dist/index.umd.min.js"></script>
    <script src="https://unpkg.com/@tiptap/react@2.1.13/dist/index.umd.min.js"></script>
    
    <!-- MathJax + ChemDoodle -->
    <script>
    MathJax = {
        tex: {
            packages: {
                '[+]': ['ams', 'mhchem', 'configmacros', 'newcommand', 'physics']
            }
        },
        svg: {
            fontCache: 'local'
        }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- ChemDoodle Web Components -->
    <script src="https://web.chemdoodle.com/install/ChemDoodleWeb.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .editor-container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .editor-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .editor-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .editor-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .editor-toolbar {
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            padding: 10px 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }
        
        .toolbar-group {
            display: flex;
            gap: 2px;
            margin-right: 15px;
            padding-right: 15px;
            border-right: 1px solid #ddd;
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .toolbar-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .toolbar-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .toolbar-btn:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .math-chemistry-group {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .math-chemistry-group .toolbar-btn {
            background: #bbdefb;
            border-color: #2196f3;
            color: #1976d2;
        }
        
        .math-chemistry-group .toolbar-btn:hover {
            background: #90caf9;
        }
        
        .section-header {
            background: #f8f9fa;
            border-bottom: 2px solid #007bff;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header h3 {
            margin: 0;
            color: #007bff;
            font-size: 1.2rem;
        }
        
        .section-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-content {
            min-height: 300px;
            padding: 20px;
            border: none;
            outline: none;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .comparison-modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .comparison-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 95%;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .comparison-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }
        
        .comparison-body {
            display: flex;
            flex: 1;
            height: calc(100% - 120px);
        }
        
        .comparison-panel {
            flex: 1;
            border-right: 2px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        
        .comparison-panel:last-child {
            border-right: none;
        }
        
        .panel-title {
            background: #f8f9fa;
            padding: 15px;
            font-weight: 600;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        
        .panel-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .original-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 4px;
        }
        
        .editor-content:focus {
            outline: none;
        }
        
        .editor-content h1, .editor-content h2, .editor-content h3 {
            margin: 20px 0 10px 0;
            color: #333;
        }
        
        .editor-content p {
            margin: 10px 0;
        }
        
        .editor-content ul, .editor-content ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        
        .editor-content blockquote {
            border-left: 4px solid #007bff;
            margin: 20px 0;
            padding: 10px 20px;
            background: #f8f9fa;
        }
        
        .editor-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .editor-content pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .editor-content pre code {
            background: none;
            padding: 0;
        }
        
        .math-content {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .chemistry-content {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .editor-footer {
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .editor-status {
            color: #6c757d;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .chemdoodle-canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .math-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            min-height: 50px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="editor-header">
            <h1>🧬 DreamSeed AI Editor</h1>
            <p>TipTap + MathJax + ChemDoodle 통합 에디터</p>
        </div>
        
        <div class="editor-toolbar">
            <!-- MathML 변환 그룹 (최상단) -->
            <div class="toolbar-group" style="background: #fff3cd; border: 2px solid #ffc107; margin-right: 20px;">
                <button class="toolbar-btn" onclick="convertAllMathML()" title="모든 MathML을 일괄 변환" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
                    🔄 전체 변환
                </button>
                <button class="toolbar-btn" onclick="convertOneByOne()" title="하나씩 변환하며 확인" style="background: #d4edda; border-color: #28a745; color: #155724;">
                    👁️ 하나씩 변환
                </button>
                <button class="toolbar-btn" onclick="convertBatch()" title="배치 단위로 변환" style="background: #e3f2fd; border-color: #2196f3; color: #1976d2;">
                    📦 배치 변환
                </button>
                <button class="toolbar-btn" onclick="openConversionModal()" title="변환 설정">
                    ⚙️ 변환 설정
                </button>
                <button class="toolbar-btn" onclick="showConversionStatus()" title="변환 상태">
                    📊 변환 상태
                </button>
                <button class="toolbar-btn" onclick="showProjectProgress()" title="프로젝트 진행률">
                    🎯 프로젝트 진행률
                </button>
            </div>
            
            <!-- 기본 서식 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleFormat('bold')" title="굵게">
                    <strong>B</strong>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('italic')" title="기울임">
                    <em>I</em>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('underline')" title="밑줄">
                    <u>U</u>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('strike')" title="취소선">
                    <s>S</s>
                </button>
            </div>
            
            <!-- 제목 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="setHeading(1)" title="제목 1">H1</button>
                <button class="toolbar-btn" onclick="setHeading(2)" title="제목 2">H2</button>
                <button class="toolbar-btn" onclick="setHeading(3)" title="제목 3">H3</button>
            </div>
            
            <!-- 목록 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleList('bulletList')" title="글머리 기호 목록">
                    • 목록
                </button>
                <button class="toolbar-btn" onclick="toggleList('orderedList')" title="번호 목록">
                    1. 목록
                </button>
            </div>
            
            <!-- 인용 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleBlockquote()" title="인용">
                    " 인용
                </button>
                <button class="toolbar-btn" onclick="toggleCode()" title="코드">
                    &lt;/&gt; 코드
                </button>
            </div>
            
            <!-- 수학/화학 그룹 (특별 강조) -->
            <div class="toolbar-group math-chemistry-group">
                <button class="toolbar-btn" onclick="openMathModal()" title="수학 수식">
                    📐 수학
                </button>
                <button class="toolbar-btn" onclick="openChemistryModal()" title="화학 구조식">
                    🧪 화학
                </button>
                <button class="toolbar-btn" onclick="openBenzeneModal()" title="벤젠 고리">
                    ⬡ 벤젠
                </button>
                <button class="toolbar-btn" onclick="openNaphthaleneModal()" title="나프탈렌">
                    🔶 나프탈렌
                </button>
                <button class="toolbar-btn" onclick="openSteroidModal()" title="스테로이드">
                    🔷 스테로이드
                </button>
            </div>
            
            <!-- 정렬 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="setAlignment('left')" title="왼쪽 정렬">
                    ←
                </button>
                <button class="toolbar-btn" onclick="setAlignment('center')" title="가운데 정렬">
                    ↔
                </button>
                <button class="toolbar-btn" onclick="setAlignment('right')" title="오른쪽 정렬">
                    →
                </button>
            </div>
            
            <!-- 링크/이미지 그룹 -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="openLinkModal()" title="링크">
                    🔗 링크
                </button>
                <button class="toolbar-btn" onclick="openImageModal()" title="이미지">
                    🖼️ 이미지
                </button>
            </div>
        </div>
        
        <!-- Problem Section -->
        <div class="section-header">
            <h3>📝 Problem Section</h3>
            <div class="section-controls">
                <input type="text" id="problemId" placeholder="문제 ID 입력" style="margin-right: 10px; padding: 5px;">
                <button class="btn btn-secondary" onclick="loadProblem()">문제 로드</button>
                <button class="btn btn-secondary" onclick="compareWithOriginal()">오리지널 비교</button>
                <button class="btn btn-info" onclick="openAttributeModal()">🏷️ 속성 편집</button>
            </div>
        </div>
        
        <!-- Question Attributes Display -->
        <div id="questionAttributes" class="attributes-panel" style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 0; display: none;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">📋 문제 속성</h4>
            <div id="attributesList" style="display: flex; flex-wrap: wrap; gap: 8px;">
                <!-- 속성 태그들이 여기에 표시됩니다 -->
            </div>
        </div>
        <div class="editor-content" id="problemEditor" contenteditable="true">
            <p>문제 내용을 입력하세요...</p>
            <p>MathML 변환 테스트를 위한 샘플:</p>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <mfrac>
                    <mn>1</mn>
                    <mn>2</mn>
                </mfrac>
            </math>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <msup>
                    <mi>x</mi>
                    <mn>2</mn>
                </msup>
                <mo>+</mo>
                <mn>1</mn>
            </math>
        </div>
        
        <!-- Solution Section -->
        <div class="section-header">
            <h3>💡 Solution Section</h3>
        </div>
        <div class="editor-content" id="solutionEditor" contenteditable="true">
            <p>해답 내용을 입력하세요...</p>
        </div>
        
        <div class="editor-footer">
            <div class="editor-status">
                <span id="wordCount">단어: 0</span> | 
                <span id="charCount">글자: 0</span>
            </div>
        <div class="editor-actions">
            <button class="btn btn-secondary" onclick="clearProblem()">문제 지우기</button>
            <button class="btn btn-secondary" onclick="clearSolution()">해답 지우기</button>
            <button class="btn btn-secondary" onclick="previewContent()">미리보기</button>
            <button class="btn btn-success" onclick="saveContent()">저장</button>
        </div>
        </div>
    </div>
    
    <!-- 수학 수식 모달 -->
    <div id="mathModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📐 수학 수식 입력</h2>
                <span class="close" onclick="closeModal('mathModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="mathInput">LaTeX 수식 입력:</label>
                <textarea id="mathInput" placeholder="예: \frac{1}{2}, \int_0^1 x^2 dx, \sum_{i=1}^n i"></textarea>
            </div>
            <div class="math-preview" id="mathPreview">
                수식 미리보기가 여기에 표시됩니다...
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('mathModal')">취소</button>
                <button class="btn btn-success" onclick="insertMath()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 화학 구조식 모달 -->
    <div id="chemistryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🧪 화학 구조식 입력</h2>
                <span class="close" onclick="closeModal('chemistryModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="chemistryInput">화학 반응식 입력:</label>
                <textarea id="chemistryInput" placeholder="예: H2 + O2 -> H2O, 2H2 + O2 -> 2H2O"></textarea>
            </div>
            <div class="math-preview" id="chemistryPreview">
                화학 반응식 미리보기가 여기에 표시됩니다...
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('chemistryModal')">취소</button>
                <button class="btn btn-success" onclick="insertChemistry()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 벤젠 고리 모달 -->
    <div id="benzeneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">⬡ 벤젠 고리</h2>
                <span class="close" onclick="closeModal('benzeneModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>벤젠 고리 구조:</label>
                <div id="benzeneCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('benzeneModal')">취소</button>
                <button class="btn btn-success" onclick="insertBenzene()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 나프탈렌 모달 -->
    <div id="naphthaleneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🔶 나프탈렌</h2>
                <span class="close" onclick="closeModal('naphthaleneModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>나프탈렌 구조:</label>
                <div id="naphthaleneCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('naphthaleneModal')">취소</button>
                <button class="btn btn-success" onclick="insertNaphthalene()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 스테로이드 모달 -->
    <div id="steroidModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🔷 스테로이드</h2>
                <span class="close" onclick="closeModal('steroidModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>스테로이드 구조:</label>
                <div id="steroidCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('steroidModal')">취소</button>
                <button class="btn btn-success" onclick="insertSteroid()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 링크 모달 -->
    <div id="linkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🔗 링크 삽입</h2>
                <span class="close" onclick="closeModal('linkModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="linkText">링크 텍스트:</label>
                <input type="text" id="linkText" placeholder="링크에 표시될 텍스트">
            </div>
            <div class="form-group">
                <label for="linkUrl">URL:</label>
                <input type="url" id="linkUrl" placeholder="https://example.com">
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('linkModal')">취소</button>
                <button class="btn btn-success" onclick="insertLink()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- 이미지 모달 -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🖼️ 이미지 삽입</h2>
                <span class="close" onclick="closeModal('imageModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="imageUrl">이미지 URL:</label>
                <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg">
            </div>
            <div class="form-group">
                <label for="imageAlt">대체 텍스트:</label>
                <input type="text" id="imageAlt" placeholder="이미지 설명">
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('imageModal')">취소</button>
                <button class="btn btn-success" onclick="insertImage()">삽입</button>
            </div>
        </div>
    </div>
    
    <!-- MathML 변환 설정 모달 -->
    <div id="conversionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🔄 MathML 변환 설정</h2>
                <span class="close" onclick="closeModal('conversionModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="gptApiKey">GPT-5 API 키:</label>
                <input type="password" id="gptApiKey" placeholder="sk-...">
            </div>
            <div class="form-group">
                <label for="conversionMode">변환 모드:</label>
                <select id="conversionMode" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="math">수학 (MathJax)</option>
                    <option value="chemistry">화학 (ChemDoodle)</option>
                    <option value="mixed">혼합 (MathJax + ChemDoodle)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="batchSize">배치 크기:</label>
                <input type="number" id="batchSize" value="10" min="1" max="100">
            </div>
            <div class="form-group">
                <label for="conversionTarget">변환 대상:</label>
                <select id="conversionTarget" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="both">문제 + 해답</option>
                    <option value="problem">문제만</option>
                    <option value="solution">해답만</option>
                </select>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('conversionModal')">취소</button>
                <button class="btn btn-success" onclick="saveConversionSettings()">저장</button>
            </div>
        </div>
    </div>
    
    <!-- 변환 상태 모달 -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📊 변환 상태</h2>
                <span class="close" onclick="closeModal('statusModal')">&times;</span>
            </div>
            <div id="conversionStatus">
                <div class="loading">변환 상태를 확인하는 중...</div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('statusModal')">닫기</button>
                <button class="btn btn-success" onclick="refreshStatus()">새로고침</button>
            </div>
        </div>
    </div>
    
    <!-- 프로젝트 진행률 모달 -->
    <div id="projectProgressModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">🎯 DreamSeed 프로젝트 진행률</h2>
                <span class="close" onclick="closeModal('projectProgressModal')">&times;</span>
            </div>
            <div id="projectProgressContent">
                <div class="success">
                    <h3>📊 전체 프로젝트 현황</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>MathML 변환 (핵심 작업)</h4>
                            <div id="mathmlProgress">
                                <p><strong>총 MathML:</strong> 47,780개</p>
                                <p><strong>변환 완료:</strong> <span id="convertedCount">0</span>개</p>
                                <p><strong>진행률:</strong> <span id="mathmlPercentage">0%</span></p>
                                <div style="background: #e9ecef; height: 20px; border-radius: 10px; margin: 10px 0;">
                                    <div id="mathmlProgressBar" style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4>예상 완료 시간</h4>
                            <div id="timeEstimate">
                                <p><strong>일일 목표:</strong> 800개/일</p>
                                <p><strong>예상 완료:</strong> <span id="estimatedCompletion">60일 후</span></p>
                                <p><strong>현재 속도:</strong> <span id="currentSpeed">0개/일</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="success">
                    <h3>🚀 다음 단계 (MathML 변환 완료 후)</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>AI 질문-답변 생성</h4>
                            <p>✅ 변환된 MathJax/ChemDoodle 기반</p>
                            <p>✅ GPT-5를 활용한 예상 질문 생성</p>
                            <p>✅ 자동 답변 생성 및 검증</p>
                        </div>
                        <div>
                            <h4>시스템 통합</h4>
                            <p>✅ 데이터베이스 저장</p>
                            <p>✅ 검색 및 필터링</p>
                            <p>✅ 사용자 인터페이스</p>
                        </div>
                    </div>
                </div>
                
                <div class="success">
                    <h3>📈 일일 작업 통계</h3>
                    <div id="dailyStats">
                        <p><strong>오늘 변환:</strong> <span id="todayConverted">0</span>개</p>
                        <p><strong>이번 주 평균:</strong> <span id="weeklyAverage">0</span>개/일</p>
                        <p><strong>연속 작업일:</strong> <span id="consecutiveDays">0</span>일</p>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('projectProgressModal')">닫기</button>
                <button class="btn btn-success" onclick="exportProgress()">진행률 내보내기</button>
            </div>
        </div>
    </div>
    
    <!-- 문제 속성 편집 모달 -->
    <div id="attributeModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">🏷️ 문제 속성 편집</h2>
                <span class="close" onclick="closeModal('attributeModal')">&times;</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h3>📚 기본 정보</h3>
                    <div class="form-group">
                        <label for="attrSubject">과목:</label>
                        <select id="attrSubject" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="M">수학 (Mathematics)</option>
                            <option value="P">물리 (Physics)</option>
                            <option value="C">화학 (Chemistry)</option>
                            <option value="B">생물 (Biology)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrGrade">학년:</label>
                        <select id="attrGrade" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="G09">9학년</option>
                            <option value="G10">10학년</option>
                            <option value="G11">11학년</option>
                            <option value="G12">12학년</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrLevel">난이도:</label>
                        <select id="attrLevel" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="1">1단계 (기초)</option>
                            <option value="2">2단계 (중급)</option>
                            <option value="3">3단계 (고급)</option>
                            <option value="4">4단계 (최고급)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrStatus">상태:</label>
                        <select id="attrStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="1">활성</option>
                            <option value="0">비활성</option>
                        </select>
                    </div>
                </div>
                <div>
                    <h3>🏷️ 분류 태그</h3>
                    <div class="form-group">
                        <label for="attrCategory1">주요 카테고리:</label>
                        <input type="number" id="attrCategory1" placeholder="예: 663" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrCategory2">보조 카테고리:</label>
                        <input type="number" id="attrCategory2" placeholder="예: 0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrCategory3">세부 카테고리:</label>
                        <input type="number" id="attrCategory3" placeholder="예: 0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrAnswerType">답변 유형:</label>
                        <select id="attrAnswerType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="0">객관식</option>
                            <option value="1">주관식</option>
                            <option value="2">서술형</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div>
                <h3>📝 추가 메타데이터</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="attrTitle">영문 제목:</label>
                        <input type="text" id="attrTitle" placeholder="문제의 영문 제목" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrDescription">영문 설명:</label>
                        <input type="text" id="attrDescription" placeholder="문제의 영문 설명" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                <div class="form-group">
                    <label for="attrHint">힌트:</label>
                    <textarea id="attrHint" placeholder="문제 해결 힌트" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 60px;"></textarea>
                </div>
                <div class="form-group">
                    <label for="attrExample">예시:</label>
                    <textarea id="attrExample" placeholder="문제 예시" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 60px;"></textarea>
                </div>
            </div>
            
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('attributeModal')">취소</button>
                <button class="btn btn-success" onclick="saveAttributes()">저장</button>
                <button class="btn btn-info" onclick="loadFromDatabase()">DB에서 로드</button>
            </div>
        </div>
    </div>
    
    <!-- 개별 MathML 변환 모달 -->
    <div id="individualConversionModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; width: 95%;">
            <div class="modal-header">
                <h2 class="modal-title">👁️ 개별 MathML 변환</h2>
                <span class="close" onclick="closeIndividualConversion()">&times;</span>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <h3>원본 MathML</h3>
                    <div id="originalMathML" style="background: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; font-family: monospace; white-space: pre-wrap;"></div>
                </div>
                <div style="flex: 1;">
                    <h3>변환된 결과</h3>
                    <div id="convertedMathML" style="background: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <h3>원본 렌더링</h3>
                    <div id="originalRendering" style="background: #fff3e0; padding: 15px; border: 1px solid #ff9800; border-radius: 4px; min-height: 100px; text-align: center;"></div>
                </div>
                <div style="flex: 1;">
                    <h3>변환된 렌더링</h3>
                    <div id="convertedRendering" style="background: #e8f5e8; padding: 15px; border: 1px solid #4caf50; border-radius: 4px; min-height: 100px; text-align: center;"></div>
                </div>
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <div id="conversionProgress" style="margin-bottom: 10px; font-weight: bold; color: #007bff;"></div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="approveConversion()" id="approveBtn" disabled>✅ 승인</button>
                    <button class="btn btn-danger" onclick="rejectConversion()" id="rejectBtn" disabled>❌ 거부</button>
                    <button class="btn btn-secondary" onclick="skipConversion()" id="skipBtn" disabled>⏭️ 건너뛰기</button>
                    <button class="btn btn-info" onclick="regenerateConversion()" id="regenerateBtn" disabled>🔄 재생성</button>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeIndividualConversion()">닫기</button>
            </div>
        </div>
    </div>
    
    <!-- 오리지널 vs 뉴 변환 비교 모달 -->
    <div id="comparisonModal" class="comparison-modal" style="display: none;">
        <div class="comparison-content">
            <div class="comparison-header">
                <h2>🔍 오리지널 vs 뉴 변환 비교</h2>
                <p>문제 ID: <span id="comparisonProblemId">-</span></p>
            </div>
            <div class="comparison-body">
                <div class="comparison-panel">
                    <div class="panel-title">📐 mpcstudy.com 오리지널 (Wiris)</div>
                    <div class="panel-content">
                        <iframe id="originalIframe" class="original-iframe" src=""></iframe>
                    </div>
                </div>
                <div class="comparison-panel">
                    <div class="panel-title">🧪 새로운 변환 (MathJax + ChemDoodle)</div>
                    <div class="panel-content" id="newConversionContent">
                        <div class="loading">새로운 변환 결과를 로드하는 중...</div>
                    </div>
                </div>
            </div>
            <div style="padding: 20px; text-align: center; border-top: 1px solid #ddd;">
                <button class="btn btn-secondary" onclick="closeComparison()">닫기</button>
                <button class="btn btn-success" onclick="markAsCorrect()">정확함</button>
                <button class="btn btn-danger" onclick="markAsError()">오류 있음</button>
            </div>
        </div>
    </div>
    
    <script>
        class DreamSeedEditor {
            constructor() {
                this.problemEditor = null;
                this.solutionEditor = null;
                this.init();
            }
            
            init() {
                // 에디터 초기화
                this.setupEventListeners();
                this.updateWordCount();
            }
            
            setupEventListeners() {
                const problemEditor = document.getElementById('problemEditor');
                const solutionEditor = document.getElementById('solutionEditor');
                
                // 입력 이벤트
                problemEditor.addEventListener('input', () => {
                    this.updateWordCount();
                });
                
                solutionEditor.addEventListener('input', () => {
                    this.updateWordCount();
                });
                
                // 수학 입력 실시간 미리보기
                document.getElementById('mathInput').addEventListener('input', (e) => {
                    this.updateMathPreview(e.target.value);
                });
                
                // 화학 입력 실시간 미리보기
                document.getElementById('chemistryInput').addEventListener('input', (e) => {
                    this.updateChemistryPreview(e.target.value);
                });
            }
            
            updateWordCount() {
                const problemEditor = document.getElementById('problemEditor');
                const solutionEditor = document.getElementById('solutionEditor');
                
                const problemText = problemEditor.textContent || problemEditor.innerText || '';
                const solutionText = solutionEditor.textContent || solutionEditor.innerText || '';
                const totalText = problemText + ' ' + solutionText;
                
                const words = totalText.trim().split(/\s+/).filter(word => word.length > 0);
                const chars = totalText.length;
                
                document.getElementById('wordCount').textContent = `단어: ${words.length}`;
                document.getElementById('charCount').textContent = `글자: ${chars}`;
            }
            
            updateMathPreview(latex) {
                const preview = document.getElementById('mathPreview');
                if (latex.trim()) {
                    preview.innerHTML = `$$${latex}$$`;
                    MathJax.typesetPromise([preview]);
                } else {
                    preview.innerHTML = '수식 미리보기가 여기에 표시됩니다...';
                }
            }
            
            updateChemistryPreview(chemistry) {
                const preview = document.getElementById('chemistryPreview');
                if (chemistry.trim()) {
                    preview.innerHTML = `\\ce{${chemistry}}`;
                    MathJax.typesetPromise([preview]);
                } else {
                    preview.innerHTML = '화학 반응식 미리보기가 여기에 표시됩니다...';
                }
            }
            
            insertContent(content, type = 'html', targetEditor = 'problem') {
                const editor = document.getElementById(targetEditor === 'problem' ? 'problemEditor' : 'solutionEditor');
                const selection = window.getSelection();
                
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    
                    if (type === 'html') {
                        const div = document.createElement('div');
                        div.innerHTML = content;
                        range.insertNode(div.firstChild);
                    } else {
                        range.insertNode(document.createTextNode(content));
                    }
                    
                    // 커서를 삽입된 내용 뒤로 이동
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    // 선택이 없으면 에디터 끝에 삽입
                    editor.innerHTML += content;
                }
                
                this.updateWordCount();
            }
        }
        
        // 전역 변수
        let dreamSeedEditor;
        let conversionSettings = {
            apiKey: '',
            mode: 'mixed',
            batchSize: 10,
            target: 'both'
        };
        let conversionStats = {
            total: 0,
            converted: 0,
            errors: 0,
            startTime: null
        };
        
        // 개별 변환을 위한 전역 변수
        let currentMathMLList = [];
        let currentMathMLIndex = 0;
        let currentConvertedResult = '';
        
        // 프로젝트 진행률 추적
        let projectStats = {
            totalMathML: 47780,
            converted: 0,
            dailyGoal: 800,
            startDate: new Date(),
            dailyStats: {},
            weeklyStats: []
        };
        
        // 문제 속성 데이터
        let questionAttributes = {
            que_id: '',
            que_status: 1,
            que_class: 'M',
            que_category1: 0,
            que_category2: 0,
            que_category3: 0,
            que_grade: 'G09',
            que_level: 1,
            que_en_title: '',
            que_en_desc: '',
            que_en_hint: '',
            que_en_solution: '',
            que_en_answers: '',
            que_en_answerm: '',
            que_answertype: 0,
            que_en_example: '',
            que_en_resource: '',
            que_createddate: '',
            que_modifieddate: ''
        };
        
        // MathML 변환 관련 함수들
        function convertAllMathML() {
            if (!conversionSettings.apiKey) {
                alert('먼저 변환 설정에서 GPT-5 API 키를 입력해주세요.');
                openConversionModal();
                return;
            }
            
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            // MathML 태그 찾기
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            const totalMathML = problemMathML.length + solutionMathML.length;
            
            if (totalMathML === 0) {
                alert('변환할 MathML이 없습니다.');
                return;
            }
            
            if (confirm(`${totalMathML}개의 MathML 태그를 일괄 변환하시겠습니까?`)) {
                startBatchConversion(problemMathML, solutionMathML);
            }
        }
        
        function convertOneByOne() {
            if (!conversionSettings.apiKey) {
                alert('먼저 변환 설정에서 GPT-5 API 키를 입력해주세요.');
                openConversionModal();
                return;
            }
            
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            // MathML 태그 찾기
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            currentMathMLList = [...problemMathML, ...solutionMathML];
            currentMathMLIndex = 0;
            
            if (currentMathMLList.length === 0) {
                alert('변환할 MathML이 없습니다.');
                return;
            }
            
            // 개별 변환 모달 열기
            document.getElementById('individualConversionModal').style.display = 'block';
            processNextMathML();
        }
        
        async function processNextMathML() {
            if (currentMathMLIndex >= currentMathMLList.length) {
                alert('모든 MathML 변환이 완료되었습니다!');
                closeIndividualConversion();
                return;
            }
            
            const currentMathML = currentMathMLList[currentMathMLIndex];
            
            // 진행 상황 업데이트
            document.getElementById('conversionProgress').textContent = 
                `${currentMathMLIndex + 1} / ${currentMathMLList.length} - 변환 중...`;
            
            // 원본 MathML 표시
            document.getElementById('originalMathML').textContent = currentMathML;
            
            // 원본 렌더링 (MathML을 직접 렌더링)
            document.getElementById('originalRendering').innerHTML = currentMathML;
            
            // 버튼 비활성화
            document.getElementById('approveBtn').disabled = true;
            document.getElementById('rejectBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
            document.getElementById('regenerateBtn').disabled = true;
            
            try {
                // GPT-5로 변환
                currentConvertedResult = await convertSingleMathML(currentMathML);
                
                // 변환된 결과 표시
                document.getElementById('convertedMathML').textContent = currentConvertedResult;
                
                // 변환된 렌더링 표시
                document.getElementById('convertedRendering').innerHTML = currentConvertedResult;
                
                // MathJax 렌더링
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('convertedRendering')]);
                }
                
                // 버튼 활성화
                document.getElementById('approveBtn').disabled = false;
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
                
                document.getElementById('conversionProgress').textContent = 
                    `${currentMathMLIndex + 1} / ${currentMathMLList.length} - 변환 완료 (검토 필요)`;
                
            } catch (error) {
                console.error('변환 오류:', error);
                document.getElementById('convertedMathML').textContent = '변환 오류: ' + error.message;
                document.getElementById('convertedRendering').innerHTML = '<div class="error">변환 실패</div>';
                
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
            }
        }
        
        function approveConversion() {
            // 현재 MathML을 변환된 결과로 교체
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            const currentMathML = currentMathMLList[currentMathMLIndex];
            
            // 문제 섹션에서 교체
            if (problemContent.includes(currentMathML)) {
                const newProblemContent = problemContent.replace(currentMathML, currentConvertedResult);
                document.getElementById('problemEditor').innerHTML = newProblemContent;
            }
            
            // 해답 섹션에서 교체
            if (solutionContent.includes(currentMathML)) {
                const newSolutionContent = solutionContent.replace(currentMathML, currentConvertedResult);
                document.getElementById('solutionEditor').innerHTML = newSolutionContent;
            }
            
            // MathJax 재렌더링
            if (window.MathJax) {
                MathJax.typesetPromise([document.getElementById('problemEditor'), document.getElementById('solutionEditor')]);
            }
            
            // 프로젝트 통계 업데이트
            projectStats.converted++;
            const today = new Date().toDateString();
            projectStats.dailyStats[today] = (projectStats.dailyStats[today] || 0) + 1;
            updateProjectProgress();
            
            // 다음으로 이동
            currentMathMLIndex++;
            processNextMathML();
        }
        
        function rejectConversion() {
            // 거부된 변환은 건너뛰기
            currentMathMLIndex++;
            processNextMathML();
        }
        
        function skipConversion() {
            // 건너뛰기
            currentMathMLIndex++;
            processNextMathML();
        }
        
        async function regenerateConversion() {
            // 재생성
            document.getElementById('conversionProgress').textContent = 
                `${currentMathMLIndex + 1} / ${currentMathMLList.length} - 재생성 중...`;
            
            document.getElementById('approveBtn').disabled = true;
            document.getElementById('rejectBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
            document.getElementById('regenerateBtn').disabled = true;
            
            try {
                const currentMathML = currentMathMLList[currentMathMLIndex];
                currentConvertedResult = await convertSingleMathML(currentMathML);
                
                document.getElementById('convertedMathML').textContent = currentConvertedResult;
                document.getElementById('convertedRendering').innerHTML = currentConvertedResult;
                
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('convertedRendering')]);
                }
                
                document.getElementById('approveBtn').disabled = false;
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
                
                document.getElementById('conversionProgress').textContent = 
                    `${currentMathMLIndex + 1} / ${currentMathMLList.length} - 재생성 완료 (검토 필요)`;
                
            } catch (error) {
                console.error('재생성 오류:', error);
                document.getElementById('convertedMathML').textContent = '재생성 오류: ' + error.message;
                document.getElementById('convertedRendering').innerHTML = '<div class="error">재생성 실패</div>';
                
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
            }
        }
        
        function closeIndividualConversion() {
            document.getElementById('individualConversionModal').style.display = 'none';
            currentMathMLList = [];
            currentMathMLIndex = 0;
        }
        
        // 배치 변환 함수
        function convertBatch() {
            if (!conversionSettings.apiKey) {
                alert('먼저 변환 설정에서 GPT-5 API 키를 입력해주세요.');
                openConversionModal();
                return;
            }
            
            const batchSize = conversionSettings.batchSize || 10;
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            const totalMathML = problemMathML.length + solutionMathML.length;
            
            if (totalMathML === 0) {
                alert('변환할 MathML이 없습니다.');
                return;
            }
            
            const batches = Math.ceil(totalMathML / batchSize);
            
            if (confirm(`${totalMathML}개의 MathML을 ${batches}개 배치로 나누어 변환하시겠습니까?\n배치 크기: ${batchSize}개`)) {
                startBatchProcessing(problemMathML, solutionMathML, batchSize);
            }
        }
        
        async function startBatchProcessing(problemMathML, solutionMathML, batchSize) {
            const allMathML = [...problemMathML, ...solutionMathML];
            const batches = [];
            
            for (let i = 0; i < allMathML.length; i += batchSize) {
                batches.push(allMathML.slice(i, i + batchSize));
            }
            
            for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {
                const batch = batches[batchIndex];
                console.log(`배치 ${batchIndex + 1}/${batches.length} 처리 중... (${batch.length}개)`);
                
                // 배치별로 변환
                for (const mathml of batch) {
                    try {
                        const converted = await convertSingleMathML(mathml);
                        
                        // 문제 섹션에서 교체
                        if (problemMathML.includes(mathml)) {
                            const newContent = document.getElementById('problemEditor').innerHTML.replace(mathml, converted);
                            document.getElementById('problemEditor').innerHTML = newContent;
                        }
                        
                        // 해답 섹션에서 교체
                        if (solutionMathML.includes(mathml)) {
                            const newContent = document.getElementById('solutionEditor').innerHTML.replace(mathml, converted);
                            document.getElementById('solutionEditor').innerHTML = newContent;
                        }
                        
                        projectStats.converted++;
                        updateProjectProgress();
                        
                    } catch (error) {
                        console.error('배치 변환 오류:', error);
                    }
                }
                
                // MathJax 재렌더링
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('problemEditor'), document.getElementById('solutionEditor')]);
                }
                
                // 배치 간 잠시 대기 (API 제한 고려)
                if (batchIndex < batches.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            alert(`배치 변환 완료!\n총 ${projectStats.converted}개 변환 성공`);
        }
        
        // 프로젝트 진행률 표시
        function showProjectProgress() {
            updateProjectProgress();
            document.getElementById('projectProgressModal').style.display = 'block';
        }
        
        function updateProjectProgress() {
            const percentage = Math.round((projectStats.converted / projectStats.totalMathML) * 100);
            
            document.getElementById('convertedCount').textContent = projectStats.converted.toLocaleString();
            document.getElementById('mathmlPercentage').textContent = percentage + '%';
            document.getElementById('mathmlProgressBar').style.width = percentage + '%';
            
            // 예상 완료 시간 계산
            const remaining = projectStats.totalMathML - projectStats.converted;
            const daysRemaining = Math.ceil(remaining / projectStats.dailyGoal);
            const completionDate = new Date();
            completionDate.setDate(completionDate.getDate() + daysRemaining);
            
            document.getElementById('estimatedCompletion').textContent = 
                completionDate.toLocaleDateString() + ` (${daysRemaining}일 후)`;
            
            // 현재 속도 계산 (최근 7일 평균)
            const today = new Date().toDateString();
            const todayConverted = projectStats.dailyStats[today] || 0;
            document.getElementById('todayConverted').textContent = todayConverted;
            
            // 주간 평균 계산
            const weeklyTotal = Object.values(projectStats.dailyStats).reduce((sum, count) => sum + count, 0);
            const weeklyAverage = Math.round(weeklyTotal / 7);
            document.getElementById('weeklyAverage').textContent = weeklyAverage;
            
            // 연속 작업일 계산
            const consecutiveDays = calculateConsecutiveDays();
            document.getElementById('consecutiveDays').textContent = consecutiveDays;
            
            // 통계를 로컬 스토리지에 저장
            localStorage.setItem('projectStats', JSON.stringify(projectStats));
        }
        
        function calculateConsecutiveDays() {
            const today = new Date();
            let consecutive = 0;
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toDateString();
                
                if (projectStats.dailyStats[dateString] && projectStats.dailyStats[dateString] > 0) {
                    consecutive++;
                } else {
                    break;
                }
            }
            
            return consecutive;
        }
        
        function exportProgress() {
            const progressData = {
                totalMathML: projectStats.totalMathML,
                converted: projectStats.converted,
                percentage: Math.round((projectStats.converted / projectStats.totalMathML) * 100),
                dailyStats: projectStats.dailyStats,
                lastUpdated: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `dreamseed_progress_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        // 문제 속성 관련 함수들
        function openAttributeModal() {
            // 현재 속성 데이터를 모달에 로드
            loadAttributesToModal();
            document.getElementById('attributeModal').style.display = 'block';
        }
        
        function loadAttributesToModal() {
            document.getElementById('attrSubject').value = questionAttributes.que_class || 'M';
            document.getElementById('attrGrade').value = questionAttributes.que_grade || 'G09';
            document.getElementById('attrLevel').value = questionAttributes.que_level || 1;
            document.getElementById('attrStatus').value = questionAttributes.que_status || 1;
            document.getElementById('attrCategory1').value = questionAttributes.que_category1 || 0;
            document.getElementById('attrCategory2').value = questionAttributes.que_category2 || 0;
            document.getElementById('attrCategory3').value = questionAttributes.que_category3 || 0;
            document.getElementById('attrAnswerType').value = questionAttributes.que_answertype || 0;
            document.getElementById('attrTitle').value = questionAttributes.que_en_title || '';
            document.getElementById('attrDescription').value = questionAttributes.que_en_desc || '';
            document.getElementById('attrHint').value = questionAttributes.que_en_hint || '';
            document.getElementById('attrExample').value = questionAttributes.que_en_example || '';
        }
        
        function saveAttributes() {
            // 모달에서 속성 데이터를 읽어와서 저장
            questionAttributes.que_class = document.getElementById('attrSubject').value;
            questionAttributes.que_grade = document.getElementById('attrGrade').value;
            questionAttributes.que_level = parseInt(document.getElementById('attrLevel').value);
            questionAttributes.que_status = parseInt(document.getElementById('attrStatus').value);
            questionAttributes.que_category1 = parseInt(document.getElementById('attrCategory1').value) || 0;
            questionAttributes.que_category2 = parseInt(document.getElementById('attrCategory2').value) || 0;
            questionAttributes.que_category3 = parseInt(document.getElementById('attrCategory3').value) || 0;
            questionAttributes.que_answertype = parseInt(document.getElementById('attrAnswerType').value);
            questionAttributes.que_en_title = document.getElementById('attrTitle').value;
            questionAttributes.que_en_desc = document.getElementById('attrDescription').value;
            questionAttributes.que_en_hint = document.getElementById('attrHint').value;
            questionAttributes.que_en_example = document.getElementById('attrExample').value;
            questionAttributes.que_modifieddate = new Date().toISOString().replace('T', '').split('.')[0];
            
            // 속성 패널 업데이트
            updateAttributesDisplay();
            
            // 로컬 스토리지에 저장
            localStorage.setItem('questionAttributes', JSON.stringify(questionAttributes));
            
            alert('문제 속성이 저장되었습니다.');
            closeModal('attributeModal');
        }
        
        function updateAttributesDisplay() {
            const attributesList = document.getElementById('attributesList');
            const attributesPanel = document.getElementById('questionAttributes');
            
            // 기존 태그들 제거
            attributesList.innerHTML = '';
            
            // 속성 태그들 생성
            const tags = [
                { label: '과목', value: getSubjectName(questionAttributes.que_class), color: '#007bff' },
                { label: '학년', value: questionAttributes.que_grade, color: '#28a745' },
                { label: '난이도', value: `${questionAttributes.que_level}단계`, color: '#ffc107' },
                { label: '상태', value: questionAttributes.que_status ? '활성' : '비활성', color: questionAttributes.que_status ? '#28a745' : '#dc3545' },
                { label: '카테고리1', value: questionAttributes.que_category1, color: '#6f42c1' },
                { label: '카테고리2', value: questionAttributes.que_category2, color: '#6f42c1' },
                { label: '카테고리3', value: questionAttributes.que_category3, color: '#6f42c1' },
                { label: '답변유형', value: getAnswerTypeName(questionAttributes.que_answertype), color: '#17a2b8' }
            ];
            
            tags.forEach(tag => {
                if (tag.value && tag.value !== '0' && tag.value !== '') {
                    const tagElement = document.createElement('span');
                    tagElement.style.cssText = `
                        background: ${tag.color};
                        color: white;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                        font-weight: 500;
                        display: inline-block;
                        margin: 2px;
                    `;
                    tagElement.textContent = `${tag.label}: ${tag.value}`;
                    attributesList.appendChild(tagElement);
                }
            });
            
            // 속성 패널 표시
            attributesPanel.style.display = 'block';
        }
        
        function getSubjectName(code) {
            const subjects = {
                'M': '수학',
                'P': '물리',
                'C': '화학',
                'B': '생물'
            };
            return subjects[code] || code;
        }
        
        function getAnswerTypeName(type) {
            const types = {
                0: '객관식',
                1: '주관식',
                2: '서술형'
            };
            return types[type] || type;
        }
        
        function loadFromDatabase() {
            const problemId = document.getElementById('problemId').value;
            if (!problemId.trim()) {
                alert('문제 ID를 입력해주세요.');
                return;
            }
            
            // 실제 구현에서는 API 호출로 데이터베이스에서 문제 정보를 가져옴
            // 여기서는 샘플 데이터로 시뮬레이션
            const sampleData = {
                que_id: problemId,
                que_status: 1,
                que_class: 'M',
                que_category1: 663,
                que_category2: 0,
                que_category3: 0,
                que_grade: 'G09',
                que_level: 3,
                que_en_title: 'Calculation bases on weight-weight relationship',
                que_en_desc: 'What is the amount of NH3 formed when 14 g of N2 combines with 6 g of H2?',
                que_en_hint: 'Use stoichiometry to solve this problem',
                que_en_solution: 'Solution will be loaded from database...',
                que_en_answers: '',
                que_en_answerm: '',
                que_answertype: 0,
                que_en_example: '',
                que_en_resource: '',
                que_createddate: '20191207103340',
                que_modifieddate: '20221009173006'
            };
            
            // 속성 데이터 업데이트
            questionAttributes = { ...questionAttributes, ...sampleData };
            
            // 모달에 로드
            loadAttributesToModal();
            
            alert('데이터베이스에서 문제 정보를 로드했습니다.');
        }
        
        async function startBatchConversion(problemMathML, solutionMathML) {
            conversionStats = {
                total: problemMathML.length + solutionMathML.length,
                converted: 0,
                errors: 0,
                startTime: new Date()
            };
            
            try {
                // 문제 섹션 변환
                if (conversionSettings.target === 'both' || conversionSettings.target === 'problem') {
                    await convertMathMLInEditor('problemEditor', problemMathML);
                }
                
                // 해답 섹션 변환
                if (conversionSettings.target === 'both' || conversionSettings.target === 'solution') {
                    await convertMathMLInEditor('solutionEditor', solutionMathML);
                }
                
                // 변환 완료 알림
                const elapsed = Math.round((new Date() - conversionStats.startTime) / 1000);
                alert(`변환 완료!\n총 ${conversionStats.total}개 중 ${conversionStats.converted}개 변환 성공\n오류: ${conversionStats.errors}개\n소요 시간: ${elapsed}초`);
                
            } catch (error) {
                console.error('변환 중 오류:', error);
                alert('변환 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        async function convertMathMLInEditor(editorId, mathmlArray) {
            const editor = document.getElementById(editorId);
            let content = editor.innerHTML;
            
            for (const mathml of mathmlArray) {
                try {
                    const converted = await convertSingleMathML(mathml);
                    content = content.replace(mathml, converted);
                    conversionStats.converted++;
                } catch (error) {
                    console.error('MathML 변환 오류:', error);
                    conversionStats.errors++;
                }
            }
            
            editor.innerHTML = content;
            
            // MathJax 재렌더링
            if (window.MathJax) {
                MathJax.typesetPromise([editor]);
            }
        }
        
        async function convertSingleMathML(mathml) {
            const prompt = createConversionPrompt(mathml);
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${conversionSettings.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-5',
                    messages: [
                        {
                            role: 'system',
                            content: '당신은 MathML을 MathJax/ChemDoodle 형식으로 변환하는 전문가입니다. 정확하고 깔끔한 변환을 제공하세요.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.1
                })
            });
            
            if (!response.ok) {
                throw new Error(`API 오류: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }
        
        function createConversionPrompt(mathml) {
            const mode = conversionSettings.mode;
            
            let systemPrompt = '';
            if (mode === 'math') {
                systemPrompt = '이 MathML을 MathJax LaTeX 형식으로 변환하세요. 수학 수식에만 집중하세요.';
            } else if (mode === 'chemistry') {
                systemPrompt = '이 MathML을 ChemDoodle 형식으로 변환하세요. 화학 구조식과 반응식에 집중하세요.';
            } else {
                systemPrompt = '이 MathML을 MathJax (수학) 또는 ChemDoodle (화학) 형식으로 변환하세요. 내용에 따라 적절한 형식을 선택하세요.';
            }
            
            return `${systemPrompt}\n\nMathML:\n${mathml}\n\n변환된 결과만 반환하세요:`;
        }
        
        function openConversionModal() {
            // 저장된 설정 로드
            document.getElementById('gptApiKey').value = conversionSettings.apiKey;
            document.getElementById('conversionMode').value = conversionSettings.mode;
            document.getElementById('batchSize').value = conversionSettings.batchSize;
            document.getElementById('conversionTarget').value = conversionSettings.target;
            
            document.getElementById('conversionModal').style.display = 'block';
        }
        
        function saveConversionSettings() {
            conversionSettings.apiKey = document.getElementById('gptApiKey').value;
            conversionSettings.mode = document.getElementById('conversionMode').value;
            conversionSettings.batchSize = parseInt(document.getElementById('batchSize').value);
            conversionSettings.target = document.getElementById('conversionTarget').value;
            
            // 로컬 스토리지에 저장
            localStorage.setItem('conversionSettings', JSON.stringify(conversionSettings));
            
            alert('변환 설정이 저장되었습니다.');
            closeModal('conversionModal');
        }
        
        function showConversionStatus() {
            const statusDiv = document.getElementById('conversionStatus');
            
            if (conversionStats.startTime) {
                const elapsed = Math.round((new Date() - conversionStats.startTime) / 1000);
                const progress = conversionStats.total > 0 ? (conversionStats.converted / conversionStats.total * 100).toFixed(1) : 0;
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <h3>변환 통계</h3>
                        <p><strong>총 MathML:</strong> ${conversionStats.total}개</p>
                        <p><strong>변환 완료:</strong> ${conversionStats.converted}개</p>
                        <p><strong>오류:</strong> ${conversionStats.errors}개</p>
                        <p><strong>진행률:</strong> ${progress}%</p>
                        <p><strong>소요 시간:</strong> ${elapsed}초</p>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = '<div class="error">아직 변환이 시작되지 않았습니다.</div>';
            }
            
            document.getElementById('statusModal').style.display = 'block';
        }
        
        function refreshStatus() {
            showConversionStatus();
        }
        
        // 모달 관련 함수들
        function openMathModal() {
            document.getElementById('mathModal').style.display = 'block';
            document.getElementById('mathInput').focus();
        }
        
        function openChemistryModal() {
            document.getElementById('chemistryModal').style.display = 'block';
            document.getElementById('chemistryInput').focus();
        }
        
        function openBenzeneModal() {
            document.getElementById('benzeneModal').style.display = 'block';
            createBenzeneStructure();
        }
        
        function openNaphthaleneModal() {
            document.getElementById('naphthaleneModal').style.display = 'block';
            createNaphthaleneStructure();
        }
        
        function openSteroidModal() {
            document.getElementById('steroidModal').style.display = 'block';
            createSteroidStructure();
        }
        
        function openLinkModal() {
            document.getElementById('linkModal').style.display = 'block';
            document.getElementById('linkText').focus();
        }
        
        function openImageModal() {
            document.getElementById('imageModal').style.display = 'block';
            document.getElementById('imageUrl').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // 수식 삽입
        function insertMath() {
            const mathInput = document.getElementById('mathInput').value;
            if (mathInput.trim()) {
                const mathContent = `<div class="math-content">$$${mathInput}$$</div>`;
                dreamSeedEditor.insertContent(mathContent, 'html', 'problem');
                closeModal('mathModal');
                document.getElementById('mathInput').value = '';
            }
        }
        
        // 화학 반응식 삽입
        function insertChemistry() {
            const chemistryInput = document.getElementById('chemistryInput').value;
            if (chemistryInput.trim()) {
                const chemistryContent = `<div class="chemistry-content">\\ce{${chemistryInput}}</div>`;
                dreamSeedEditor.insertContent(chemistryContent, 'html', 'problem');
                closeModal('chemistryModal');
                document.getElementById('chemistryInput').value = '';
            }
        }
        
        // 벤젠 고리 삽입
        function insertBenzene() {
            const benzeneContent = `<div class="chemistry-content" data-type="benzene">벤젠 고리 (C₆H₆)</div>`;
            dreamSeedEditor.insertContent(benzeneContent, 'html', 'problem');
            closeModal('benzeneModal');
        }
        
        // 나프탈렌 삽입
        function insertNaphthalene() {
            const naphthaleneContent = `<div class="chemistry-content" data-type="naphthalene">나프탈렌 (C₁₀H₈)</div>`;
            dreamSeedEditor.insertContent(naphthaleneContent, 'html', 'problem');
            closeModal('naphthaleneModal');
        }
        
        // 스테로이드 삽입
        function insertSteroid() {
            const steroidContent = `<div class="chemistry-content" data-type="steroid">스테로이드 구조</div>`;
            dreamSeedEditor.insertContent(steroidContent, 'html', 'problem');
            closeModal('steroidModal');
        }
        
        // 링크 삽입
        function insertLink() {
            const linkText = document.getElementById('linkText').value;
            const linkUrl = document.getElementById('linkUrl').value;
            
            if (linkText && linkUrl) {
                const linkContent = `<a href="${linkUrl}" target="_blank">${linkText}</a>`;
                dreamSeedEditor.insertContent(linkContent, 'html', 'problem');
                closeModal('linkModal');
                document.getElementById('linkText').value = '';
                document.getElementById('linkUrl').value = '';
            }
        }
        
        // 이미지 삽입
        function insertImage() {
            const imageUrl = document.getElementById('imageUrl').value;
            const imageAlt = document.getElementById('imageAlt').value;
            
            if (imageUrl) {
                const imageContent = `<img src="${imageUrl}" alt="${imageAlt || ''}" style="max-width: 100%; height: auto;">`;
                dreamSeedEditor.insertContent(imageContent, 'html', 'problem');
                closeModal('imageModal');
                document.getElementById('imageUrl').value = '';
                document.getElementById('imageAlt').value = '';
            }
        }
        
        // ChemDoodle 구조 생성
        function createBenzeneStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('benzeneCanvas', 300, 200);
                const benzene = new ChemDoodle.Molecule();
                
                // 벤젠 고리 원자들
                const atoms = [
                    new ChemDoodle.Atom(0, 100, 0, 'C'),
                    new ChemDoodle.Atom(87, 50, 0, 'C'),
                    new ChemDoodle.Atom(87, -50, 0, 'C'),
                    new ChemDoodle.Atom(0, -100, 0, 'C'),
                    new ChemDoodle.Atom(-87, -50, 0, 'C'),
                    new ChemDoodle.Atom(-87, 50, 0, 'C')
                ];
                
                atoms.forEach(atom => benzene.addAtom(atom));
                
                // 벤젠 고리 결합들
                const bonds = [
                    new ChemDoodle.Bond(0, 1, 1),
                    new ChemDoodle.Bond(1, 2, 2),
                    new ChemDoodle.Bond(2, 3, 1),
                    new ChemDoodle.Bond(3, 4, 2),
                    new ChemDoodle.Bond(4, 5, 1),
                    new ChemDoodle.Bond(5, 0, 2)
                ];
                
                bonds.forEach(bond => benzene.addBond(bond));
                canvas.loadMolecule(benzene);
            }
        }
        
        function createNaphthaleneStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('naphthaleneCanvas', 300, 200);
                // 나프탈렌 구조 생성 로직
                const naphthalene = new ChemDoodle.Molecule();
                canvas.loadMolecule(naphthalene);
            }
        }
        
        function createSteroidStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('steroidCanvas', 300, 200);
                // 스테로이드 구조 생성 로직
                const steroid = new ChemDoodle.Molecule();
                canvas.loadMolecule(steroid);
            }
        }
        
        // 기본 서식 함수들
        function toggleFormat(format) {
            document.execCommand(format);
        }
        
        function setHeading(level) {
            document.execCommand('formatBlock', false, `h${level}`);
        }
        
        function toggleList(listType) {
            document.execCommand(listType);
        }
        
        function toggleBlockquote() {
            document.execCommand('formatBlock', false, 'blockquote');
        }
        
        function toggleCode() {
            document.execCommand('formatBlock', false, 'pre');
        }
        
        function setAlignment(align) {
            document.execCommand('justify' + align.charAt(0).toUpperCase() + align.slice(1));
        }
        
        // 에디터 액션 함수들
        function clearProblem() {
            if (confirm('문제 내용을 모두 지우시겠습니까?')) {
                document.getElementById('problemEditor').innerHTML = '<p>문제 내용을 입력하세요...</p>';
                dreamSeedEditor.updateWordCount();
            }
        }
        
        function clearSolution() {
            if (confirm('해답 내용을 모두 지우시겠습니까?')) {
                document.getElementById('solutionEditor').innerHTML = '<p>해답 내용을 입력하세요...</p>';
                dreamSeedEditor.updateWordCount();
            }
        }
        
        function previewContent() {
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>미리보기</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .math-content { background: #fff3e0; padding: 10px; margin: 10px 0; }
                        .chemistry-content { background: #f3e5f5; padding: 10px; margin: 10px 0; }
                        .problem-section { border: 2px solid #007bff; padding: 20px; margin-bottom: 20px; }
                        .solution-section { border: 2px solid #28a745; padding: 20px; }
                    </style>
                </head>
                <body>
                    <div class="problem-section">
                        <h2>📝 Problem Section</h2>
                        ${problemContent}
                    </div>
                    <div class="solution-section">
                        <h2>💡 Solution Section</h2>
                        ${solutionContent}
                    </div>
                </body>
                </html>
            `);
        }
        
        function saveContent() {
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            console.log('저장할 문제 내용:', problemContent);
            console.log('저장할 해답 내용:', solutionContent);
            alert('내용이 저장되었습니다! (콘솔에서 확인)');
        }
        
        // 문제 로드 함수
        function loadProblem() {
            const problemId = document.getElementById('problemId').value;
            if (problemId.trim()) {
                // 실제 구현에서는 API 호출로 문제 데이터를 가져옴
                const mockProblem = `
                    <h3>문제 ${problemId}</h3>
                    <p>다음 수식을 계산하시오:</p>
                    <div class="math-content">$$\\int_0^1 x^2 dx$$</div>
                    <p>화학 반응식을 작성하시오:</p>
                    <div class="chemistry-content">\\ce{2H2 + O2 -> 2H2O}</div>
                `;
                document.getElementById('problemEditor').innerHTML = mockProblem;
                dreamSeedEditor.updateWordCount();
            } else {
                alert('문제 ID를 입력해주세요.');
            }
        }
        
        // 오리지널 비교 함수
        function compareWithOriginal() {
            const problemId = document.getElementById('problemId').value;
            if (problemId.trim()) {
                document.getElementById('comparisonProblemId').textContent = problemId;
                document.getElementById('originalIframe').src = `https://mpcstudy.com/admin/index.php?view=question_info&que_id=${problemId}`;
                
                // 새로운 변환 결과 시뮬레이션
                const newConversionContent = `
                    <h3>새로운 변환 결과 (MathJax + ChemDoodle)</h3>
                    <div class="math-content">$$\\int_0^1 x^2 dx = \\frac{1}{3}$$</div>
                    <div class="chemistry-content">\\ce{2H2 + O2 -> 2H2O}</div>
                    <p>이 변환은 MathJax와 ChemDoodle을 사용하여 렌더링되었습니다.</p>
                `;
                document.getElementById('newConversionContent').innerHTML = newConversionContent;
                
                // MathJax 렌더링
                MathJax.typesetPromise([document.getElementById('newConversionContent')]);
                
                document.getElementById('comparisonModal').style.display = 'block';
            } else {
                alert('문제 ID를 입력해주세요.');
            }
        }
        
        // 비교 모달 닫기
        function closeComparison() {
            document.getElementById('comparisonModal').style.display = 'none';
        }
        
        // 정확함 표시
        function markAsCorrect() {
            const problemId = document.getElementById('comparisonProblemId').textContent;
            alert(`문제 ${problemId}가 정확하다고 표시되었습니다.`);
            closeComparison();
        }
        
        // 오류 있음 표시
        function markAsError() {
            const problemId = document.getElementById('comparisonProblemId').textContent;
            alert(`문제 ${problemId}에 오류가 있다고 표시되었습니다.`);
            closeComparison();
        }
        
        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal, .comparison-modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            dreamSeedEditor = new DreamSeedEditor();
            
            // 저장된 변환 설정 로드
            const savedSettings = localStorage.getItem('conversionSettings');
            if (savedSettings) {
                conversionSettings = { ...conversionSettings, ...JSON.parse(savedSettings) };
            }
            
            // 저장된 프로젝트 통계 로드
            const savedStats = localStorage.getItem('projectStats');
            if (savedStats) {
                const loadedStats = JSON.parse(savedStats);
                projectStats = { ...projectStats, ...loadedStats };
                // 날짜 객체 복원
                if (loadedStats.startDate) {
                    projectStats.startDate = new Date(loadedStats.startDate);
                }
            }
            
            // 저장된 문제 속성 로드
            const savedAttributes = localStorage.getItem('questionAttributes');
            if (savedAttributes) {
                questionAttributes = { ...questionAttributes, ...JSON.parse(savedAttributes) };
                updateAttributesDisplay();
            }
            
            // 진행률 업데이트
            updateProjectProgress();
        });
    </script>
</body>
</html>
