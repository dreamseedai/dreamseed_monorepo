<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamSeed AI Editor - TipTap + MathJax + ChemDoodle</title>
    
    <!-- TipTap Editor -->
    <script src="https://unpkg.com/@tiptap/core@2.1.13/dist/index.umd.min.js"></script>
    <script src="https://unpkg.com/@tiptap/starter-kit@2.1.13/dist/index.umd.min.js"></script>
    <script src="https://unpkg.com/@tiptap/react@2.1.13/dist/index.umd.min.js"></script>
    
    <!-- MathJax + ChemDoodle -->
    <script>
    MathJax = {
        tex: {
            packages: {
                '[+]': ['ams', 'mhchem', 'configmacros', 'newcommand', 'physics']
            }
        },
        svg: {
            fontCache: 'local'
        }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- ChemDoodle Web Components -->
    <script src="https://web.chemdoodle.com/install/ChemDoodleWeb.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .editor-container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .editor-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .editor-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .editor-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .editor-toolbar {
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            padding: 10px 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }
        
        .toolbar-group {
            display: flex;
            gap: 2px;
            margin-right: 15px;
            padding-right: 15px;
            border-right: 1px solid #ddd;
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .toolbar-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .toolbar-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .toolbar-btn:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .math-chemistry-group {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .math-chemistry-group .toolbar-btn {
            background: #bbdefb;
            border-color: #2196f3;
            color: #1976d2;
        }
        
        .math-chemistry-group .toolbar-btn:hover {
            background: #90caf9;
        }
        
        .section-header {
            background: #f8f9fa;
            border-bottom: 2px solid #007bff;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header h3 {
            margin: 0;
            color: #007bff;
            font-size: 1.2rem;
        }
        
        .section-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-content {
            min-height: 300px;
            padding: 20px;
            border: none;
            outline: none;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .comparison-modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .comparison-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 95%;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .comparison-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }
        
        .comparison-body {
            display: flex;
            flex: 1;
            height: calc(100% - 120px);
        }
        
        .comparison-panel {
            flex: 1;
            border-right: 2px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        
        .comparison-panel:last-child {
            border-right: none;
        }
        
        .panel-title {
            background: #f8f9fa;
            padding: 15px;
            font-weight: 600;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        
        .panel-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .original-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 4px;
        }
        
        .editor-content:focus {
            outline: none;
        }
        
        .editor-content h1, .editor-content h2, .editor-content h3 {
            margin: 20px 0 10px 0;
            color: #333;
        }
        
        .editor-content p {
            margin: 10px 0;
        }
        
        .editor-content ul, .editor-content ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        
        .editor-content blockquote {
            border-left: 4px solid #007bff;
            margin: 20px 0;
            padding: 10px 20px;
            background: #f8f9fa;
        }
        
        .editor-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .editor-content pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .editor-content pre code {
            background: none;
            padding: 0;
        }
        
        .math-content {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .chemistry-content {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            display: inline-block;
        }
        
        .editor-footer {
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .editor-status {
            color: #6c757d;
            font-size: 14px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .chemdoodle-canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .math-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            min-height: 50px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="editor-header">
            <h1>ğŸ§¬ DreamSeed AI Editor</h1>
            <p>TipTap + MathJax + ChemDoodle í†µí•© ì—ë””í„°</p>
        </div>
        
        <div class="editor-toolbar">
            <!-- MathML ë³€í™˜ ê·¸ë£¹ (ìµœìƒë‹¨) -->
            <div class="toolbar-group" style="background: #fff3cd; border: 2px solid #ffc107; margin-right: 20px;">
                <button class="toolbar-btn" onclick="convertAllMathML()" title="ëª¨ë“  MathMLì„ ì¼ê´„ ë³€í™˜" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
                    ğŸ”„ ì „ì²´ ë³€í™˜
                </button>
                <button class="toolbar-btn" onclick="convertOneByOne()" title="í•˜ë‚˜ì”© ë³€í™˜í•˜ë©° í™•ì¸" style="background: #d4edda; border-color: #28a745; color: #155724;">
                    ğŸ‘ï¸ í•˜ë‚˜ì”© ë³€í™˜
                </button>
                <button class="toolbar-btn" onclick="convertBatch()" title="ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë³€í™˜" style="background: #e3f2fd; border-color: #2196f3; color: #1976d2;">
                    ğŸ“¦ ë°°ì¹˜ ë³€í™˜
                </button>
                <button class="toolbar-btn" onclick="openConversionModal()" title="ë³€í™˜ ì„¤ì •">
                    âš™ï¸ ë³€í™˜ ì„¤ì •
                </button>
                <button class="toolbar-btn" onclick="showConversionStatus()" title="ë³€í™˜ ìƒíƒœ">
                    ğŸ“Š ë³€í™˜ ìƒíƒœ
                </button>
                <button class="toolbar-btn" onclick="showProjectProgress()" title="í”„ë¡œì íŠ¸ ì§„í–‰ë¥ ">
                    ğŸ¯ í”„ë¡œì íŠ¸ ì§„í–‰ë¥ 
                </button>
            </div>
            
            <!-- ê¸°ë³¸ ì„œì‹ ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleFormat('bold')" title="êµµê²Œ">
                    <strong>B</strong>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('italic')" title="ê¸°ìš¸ì„">
                    <em>I</em>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('underline')" title="ë°‘ì¤„">
                    <u>U</u>
                </button>
                <button class="toolbar-btn" onclick="toggleFormat('strike')" title="ì·¨ì†Œì„ ">
                    <s>S</s>
                </button>
            </div>
            
            <!-- ì œëª© ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="setHeading(1)" title="ì œëª© 1">H1</button>
                <button class="toolbar-btn" onclick="setHeading(2)" title="ì œëª© 2">H2</button>
                <button class="toolbar-btn" onclick="setHeading(3)" title="ì œëª© 3">H3</button>
            </div>
            
            <!-- ëª©ë¡ ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleList('bulletList')" title="ê¸€ë¨¸ë¦¬ ê¸°í˜¸ ëª©ë¡">
                    â€¢ ëª©ë¡
                </button>
                <button class="toolbar-btn" onclick="toggleList('orderedList')" title="ë²ˆí˜¸ ëª©ë¡">
                    1. ëª©ë¡
                </button>
            </div>
            
            <!-- ì¸ìš© ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleBlockquote()" title="ì¸ìš©">
                    " ì¸ìš©
                </button>
                <button class="toolbar-btn" onclick="toggleCode()" title="ì½”ë“œ">
                    &lt;/&gt; ì½”ë“œ
                </button>
            </div>
            
            <!-- ìˆ˜í•™/í™”í•™ ê·¸ë£¹ (íŠ¹ë³„ ê°•ì¡°) -->
            <div class="toolbar-group math-chemistry-group">
                <button class="toolbar-btn" onclick="openMathModal()" title="ìˆ˜í•™ ìˆ˜ì‹">
                    ğŸ“ ìˆ˜í•™
                </button>
                <button class="toolbar-btn" onclick="openChemistryModal()" title="í™”í•™ êµ¬ì¡°ì‹">
                    ğŸ§ª í™”í•™
                </button>
                <button class="toolbar-btn" onclick="openBenzeneModal()" title="ë²¤ì   ê³ ë¦¬">
                    â¬¡ ë²¤ì  
                </button>
                <button class="toolbar-btn" onclick="openNaphthaleneModal()" title="ë‚˜í”„íƒˆë Œ">
                    ğŸ”¶ ë‚˜í”„íƒˆë Œ
                </button>
                <button class="toolbar-btn" onclick="openSteroidModal()" title="ìŠ¤í…Œë¡œì´ë“œ">
                    ğŸ”· ìŠ¤í…Œë¡œì´ë“œ
                </button>
            </div>
            
            <!-- ì •ë ¬ ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="setAlignment('left')" title="ì™¼ìª½ ì •ë ¬">
                    â†
                </button>
                <button class="toolbar-btn" onclick="setAlignment('center')" title="ê°€ìš´ë° ì •ë ¬">
                    â†”
                </button>
                <button class="toolbar-btn" onclick="setAlignment('right')" title="ì˜¤ë¥¸ìª½ ì •ë ¬">
                    â†’
                </button>
            </div>
            
            <!-- ë§í¬/ì´ë¯¸ì§€ ê·¸ë£¹ -->
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="openLinkModal()" title="ë§í¬">
                    ğŸ”— ë§í¬
                </button>
                <button class="toolbar-btn" onclick="openImageModal()" title="ì´ë¯¸ì§€">
                    ğŸ–¼ï¸ ì´ë¯¸ì§€
                </button>
            </div>
        </div>
        
        <!-- Problem Section -->
        <div class="section-header">
            <h3>ğŸ“ Problem Section</h3>
            <div class="section-controls">
                <input type="text" id="problemId" placeholder="ë¬¸ì œ ID ì…ë ¥" style="margin-right: 10px; padding: 5px;">
                <button class="btn btn-secondary" onclick="loadProblem()">ë¬¸ì œ ë¡œë“œ</button>
                <button class="btn btn-secondary" onclick="compareWithOriginal()">ì˜¤ë¦¬ì§€ë„ ë¹„êµ</button>
                <button class="btn btn-info" onclick="openAttributeModal()">ğŸ·ï¸ ì†ì„± í¸ì§‘</button>
            </div>
        </div>
        
        <!-- Question Attributes Display -->
        <div id="questionAttributes" class="attributes-panel" style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 0; display: none;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">ğŸ“‹ ë¬¸ì œ ì†ì„±</h4>
            <div id="attributesList" style="display: flex; flex-wrap: wrap; gap: 8px;">
                <!-- ì†ì„± íƒœê·¸ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        <div class="editor-content" id="problemEditor" contenteditable="true">
            <p>ë¬¸ì œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</p>
            <p>MathML ë³€í™˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìƒ˜í”Œ:</p>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <mfrac>
                    <mn>1</mn>
                    <mn>2</mn>
                </mfrac>
            </math>
            <math xmlns="http://www.w3.org/1998/Math/MathML">
                <msup>
                    <mi>x</mi>
                    <mn>2</mn>
                </msup>
                <mo>+</mo>
                <mn>1</mn>
            </math>
        </div>
        
        <!-- Solution Section -->
        <div class="section-header">
            <h3>ğŸ’¡ Solution Section</h3>
        </div>
        <div class="editor-content" id="solutionEditor" contenteditable="true">
            <p>í•´ë‹µ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</p>
        </div>
        
        <div class="editor-footer">
            <div class="editor-status">
                <span id="wordCount">ë‹¨ì–´: 0</span> | 
                <span id="charCount">ê¸€ì: 0</span>
            </div>
        <div class="editor-actions">
            <button class="btn btn-secondary" onclick="clearProblem()">ë¬¸ì œ ì§€ìš°ê¸°</button>
            <button class="btn btn-secondary" onclick="clearSolution()">í•´ë‹µ ì§€ìš°ê¸°</button>
            <button class="btn btn-secondary" onclick="previewContent()">ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn btn-success" onclick="saveContent()">ì €ì¥</button>
        </div>
        </div>
    </div>
    
    <!-- ìˆ˜í•™ ìˆ˜ì‹ ëª¨ë‹¬ -->
    <div id="mathModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“ ìˆ˜í•™ ìˆ˜ì‹ ì…ë ¥</h2>
                <span class="close" onclick="closeModal('mathModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="mathInput">LaTeX ìˆ˜ì‹ ì…ë ¥:</label>
                <textarea id="mathInput" placeholder="ì˜ˆ: \frac{1}{2}, \int_0^1 x^2 dx, \sum_{i=1}^n i"></textarea>
            </div>
            <div class="math-preview" id="mathPreview">
                ìˆ˜ì‹ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('mathModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertMath()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- í™”í•™ êµ¬ì¡°ì‹ ëª¨ë‹¬ -->
    <div id="chemistryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ§ª í™”í•™ êµ¬ì¡°ì‹ ì…ë ¥</h2>
                <span class="close" onclick="closeModal('chemistryModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="chemistryInput">í™”í•™ ë°˜ì‘ì‹ ì…ë ¥:</label>
                <textarea id="chemistryInput" placeholder="ì˜ˆ: H2 + O2 -> H2O, 2H2 + O2 -> 2H2O"></textarea>
            </div>
            <div class="math-preview" id="chemistryPreview">
                í™”í•™ ë°˜ì‘ì‹ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('chemistryModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertChemistry()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- ë²¤ì   ê³ ë¦¬ ëª¨ë‹¬ -->
    <div id="benzeneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">â¬¡ ë²¤ì   ê³ ë¦¬</h2>
                <span class="close" onclick="closeModal('benzeneModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>ë²¤ì   ê³ ë¦¬ êµ¬ì¡°:</label>
                <div id="benzeneCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('benzeneModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertBenzene()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- ë‚˜í”„íƒˆë Œ ëª¨ë‹¬ -->
    <div id="naphthaleneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ”¶ ë‚˜í”„íƒˆë Œ</h2>
                <span class="close" onclick="closeModal('naphthaleneModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>ë‚˜í”„íƒˆë Œ êµ¬ì¡°:</label>
                <div id="naphthaleneCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('naphthaleneModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertNaphthalene()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- ìŠ¤í…Œë¡œì´ë“œ ëª¨ë‹¬ -->
    <div id="steroidModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ”· ìŠ¤í…Œë¡œì´ë“œ</h2>
                <span class="close" onclick="closeModal('steroidModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>ìŠ¤í…Œë¡œì´ë“œ êµ¬ì¡°:</label>
                <div id="steroidCanvas" class="chemdoodle-canvas"></div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('steroidModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertSteroid()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- ë§í¬ ëª¨ë‹¬ -->
    <div id="linkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ”— ë§í¬ ì‚½ì…</h2>
                <span class="close" onclick="closeModal('linkModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="linkText">ë§í¬ í…ìŠ¤íŠ¸:</label>
                <input type="text" id="linkText" placeholder="ë§í¬ì— í‘œì‹œë  í…ìŠ¤íŠ¸">
            </div>
            <div class="form-group">
                <label for="linkUrl">URL:</label>
                <input type="url" id="linkUrl" placeholder="https://example.com">
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('linkModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertLink()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì‚½ì…</h2>
                <span class="close" onclick="closeModal('imageModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="imageUrl">ì´ë¯¸ì§€ URL:</label>
                <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg">
            </div>
            <div class="form-group">
                <label for="imageAlt">ëŒ€ì²´ í…ìŠ¤íŠ¸:</label>
                <input type="text" id="imageAlt" placeholder="ì´ë¯¸ì§€ ì„¤ëª…">
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('imageModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="insertImage()">ì‚½ì…</button>
            </div>
        </div>
    </div>
    
    <!-- MathML ë³€í™˜ ì„¤ì • ëª¨ë‹¬ -->
    <div id="conversionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ”„ MathML ë³€í™˜ ì„¤ì •</h2>
                <span class="close" onclick="closeModal('conversionModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="gptApiKey">GPT-5 API í‚¤:</label>
                <input type="password" id="gptApiKey" placeholder="sk-...">
            </div>
            <div class="form-group">
                <label for="conversionMode">ë³€í™˜ ëª¨ë“œ:</label>
                <select id="conversionMode" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="math">ìˆ˜í•™ (MathJax)</option>
                    <option value="chemistry">í™”í•™ (ChemDoodle)</option>
                    <option value="mixed">í˜¼í•© (MathJax + ChemDoodle)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="batchSize">ë°°ì¹˜ í¬ê¸°:</label>
                <input type="number" id="batchSize" value="10" min="1" max="100">
            </div>
            <div class="form-group">
                <label for="conversionTarget">ë³€í™˜ ëŒ€ìƒ:</label>
                <select id="conversionTarget" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="both">ë¬¸ì œ + í•´ë‹µ</option>
                    <option value="problem">ë¬¸ì œë§Œ</option>
                    <option value="solution">í•´ë‹µë§Œ</option>
                </select>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('conversionModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="saveConversionSettings()">ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <!-- ë³€í™˜ ìƒíƒœ ëª¨ë‹¬ -->
    <div id="statusModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“Š ë³€í™˜ ìƒíƒœ</h2>
                <span class="close" onclick="closeModal('statusModal')">&times;</span>
            </div>
            <div id="conversionStatus">
                <div class="loading">ë³€í™˜ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('statusModal')">ë‹«ê¸°</button>
                <button class="btn btn-success" onclick="refreshStatus()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>
    </div>
    
    <!-- í”„ë¡œì íŠ¸ ì§„í–‰ë¥  ëª¨ë‹¬ -->
    <div id="projectProgressModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ¯ DreamSeed í”„ë¡œì íŠ¸ ì§„í–‰ë¥ </h2>
                <span class="close" onclick="closeModal('projectProgressModal')">&times;</span>
            </div>
            <div id="projectProgressContent">
                <div class="success">
                    <h3>ğŸ“Š ì „ì²´ í”„ë¡œì íŠ¸ í˜„í™©</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>MathML ë³€í™˜ (í•µì‹¬ ì‘ì—…)</h4>
                            <div id="mathmlProgress">
                                <p><strong>ì´ MathML:</strong> 47,780ê°œ</p>
                                <p><strong>ë³€í™˜ ì™„ë£Œ:</strong> <span id="convertedCount">0</span>ê°œ</p>
                                <p><strong>ì§„í–‰ë¥ :</strong> <span id="mathmlPercentage">0%</span></p>
                                <div style="background: #e9ecef; height: 20px; border-radius: 10px; margin: 10px 0;">
                                    <div id="mathmlProgressBar" style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4>ì˜ˆìƒ ì™„ë£Œ ì‹œê°„</h4>
                            <div id="timeEstimate">
                                <p><strong>ì¼ì¼ ëª©í‘œ:</strong> 800ê°œ/ì¼</p>
                                <p><strong>ì˜ˆìƒ ì™„ë£Œ:</strong> <span id="estimatedCompletion">60ì¼ í›„</span></p>
                                <p><strong>í˜„ì¬ ì†ë„:</strong> <span id="currentSpeed">0ê°œ/ì¼</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="success">
                    <h3>ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (MathML ë³€í™˜ ì™„ë£Œ í›„)</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>AI ì§ˆë¬¸-ë‹µë³€ ìƒì„±</h4>
                            <p>âœ… ë³€í™˜ëœ MathJax/ChemDoodle ê¸°ë°˜</p>
                            <p>âœ… GPT-5ë¥¼ í™œìš©í•œ ì˜ˆìƒ ì§ˆë¬¸ ìƒì„±</p>
                            <p>âœ… ìë™ ë‹µë³€ ìƒì„± ë° ê²€ì¦</p>
                        </div>
                        <div>
                            <h4>ì‹œìŠ¤í…œ í†µí•©</h4>
                            <p>âœ… ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥</p>
                            <p>âœ… ê²€ìƒ‰ ë° í•„í„°ë§</p>
                            <p>âœ… ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤</p>
                        </div>
                    </div>
                </div>
                
                <div class="success">
                    <h3>ğŸ“ˆ ì¼ì¼ ì‘ì—… í†µê³„</h3>
                    <div id="dailyStats">
                        <p><strong>ì˜¤ëŠ˜ ë³€í™˜:</strong> <span id="todayConverted">0</span>ê°œ</p>
                        <p><strong>ì´ë²ˆ ì£¼ í‰ê· :</strong> <span id="weeklyAverage">0</span>ê°œ/ì¼</p>
                        <p><strong>ì—°ì† ì‘ì—…ì¼:</strong> <span id="consecutiveDays">0</span>ì¼</p>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('projectProgressModal')">ë‹«ê¸°</button>
                <button class="btn btn-success" onclick="exportProgress()">ì§„í–‰ë¥  ë‚´ë³´ë‚´ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- ë¬¸ì œ ì†ì„± í¸ì§‘ ëª¨ë‹¬ -->
    <div id="attributeModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ·ï¸ ë¬¸ì œ ì†ì„± í¸ì§‘</h2>
                <span class="close" onclick="closeModal('attributeModal')">&times;</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h3>ğŸ“š ê¸°ë³¸ ì •ë³´</h3>
                    <div class="form-group">
                        <label for="attrSubject">ê³¼ëª©:</label>
                        <select id="attrSubject" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="M">ìˆ˜í•™ (Mathematics)</option>
                            <option value="P">ë¬¼ë¦¬ (Physics)</option>
                            <option value="C">í™”í•™ (Chemistry)</option>
                            <option value="B">ìƒë¬¼ (Biology)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrGrade">í•™ë…„:</label>
                        <select id="attrGrade" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="G09">9í•™ë…„</option>
                            <option value="G10">10í•™ë…„</option>
                            <option value="G11">11í•™ë…„</option>
                            <option value="G12">12í•™ë…„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrLevel">ë‚œì´ë„:</label>
                        <select id="attrLevel" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="1">1ë‹¨ê³„ (ê¸°ì´ˆ)</option>
                            <option value="2">2ë‹¨ê³„ (ì¤‘ê¸‰)</option>
                            <option value="3">3ë‹¨ê³„ (ê³ ê¸‰)</option>
                            <option value="4">4ë‹¨ê³„ (ìµœê³ ê¸‰)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attrStatus">ìƒíƒœ:</label>
                        <select id="attrStatus" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="1">í™œì„±</option>
                            <option value="0">ë¹„í™œì„±</option>
                        </select>
                    </div>
                </div>
                <div>
                    <h3>ğŸ·ï¸ ë¶„ë¥˜ íƒœê·¸</h3>
                    <div class="form-group">
                        <label for="attrCategory1">ì£¼ìš” ì¹´í…Œê³ ë¦¬:</label>
                        <input type="number" id="attrCategory1" placeholder="ì˜ˆ: 663" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrCategory2">ë³´ì¡° ì¹´í…Œê³ ë¦¬:</label>
                        <input type="number" id="attrCategory2" placeholder="ì˜ˆ: 0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrCategory3">ì„¸ë¶€ ì¹´í…Œê³ ë¦¬:</label>
                        <input type="number" id="attrCategory3" placeholder="ì˜ˆ: 0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrAnswerType">ë‹µë³€ ìœ í˜•:</label>
                        <select id="attrAnswerType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="0">ê°ê´€ì‹</option>
                            <option value="1">ì£¼ê´€ì‹</option>
                            <option value="2">ì„œìˆ í˜•</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div>
                <h3>ğŸ“ ì¶”ê°€ ë©”íƒ€ë°ì´í„°</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="attrTitle">ì˜ë¬¸ ì œëª©:</label>
                        <input type="text" id="attrTitle" placeholder="ë¬¸ì œì˜ ì˜ë¬¸ ì œëª©" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label for="attrDescription">ì˜ë¬¸ ì„¤ëª…:</label>
                        <input type="text" id="attrDescription" placeholder="ë¬¸ì œì˜ ì˜ë¬¸ ì„¤ëª…" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                <div class="form-group">
                    <label for="attrHint">íŒíŠ¸:</label>
                    <textarea id="attrHint" placeholder="ë¬¸ì œ í•´ê²° íŒíŠ¸" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 60px;"></textarea>
                </div>
                <div class="form-group">
                    <label for="attrExample">ì˜ˆì‹œ:</label>
                    <textarea id="attrExample" placeholder="ë¬¸ì œ ì˜ˆì‹œ" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 60px;"></textarea>
                </div>
            </div>
            
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('attributeModal')">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="saveAttributes()">ì €ì¥</button>
                <button class="btn btn-info" onclick="loadFromDatabase()">DBì—ì„œ ë¡œë“œ</button>
            </div>
        </div>
    </div>
    
    <!-- ê°œë³„ MathML ë³€í™˜ ëª¨ë‹¬ -->
    <div id="individualConversionModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; width: 95%;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ‘ï¸ ê°œë³„ MathML ë³€í™˜</h2>
                <span class="close" onclick="closeIndividualConversion()">&times;</span>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <h3>ì›ë³¸ MathML</h3>
                    <div id="originalMathML" style="background: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; font-family: monospace; white-space: pre-wrap;"></div>
                </div>
                <div style="flex: 1;">
                    <h3>ë³€í™˜ëœ ê²°ê³¼</h3>
                    <div id="convertedMathML" style="background: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px;"></div>
                </div>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <h3>ì›ë³¸ ë Œë”ë§</h3>
                    <div id="originalRendering" style="background: #fff3e0; padding: 15px; border: 1px solid #ff9800; border-radius: 4px; min-height: 100px; text-align: center;"></div>
                </div>
                <div style="flex: 1;">
                    <h3>ë³€í™˜ëœ ë Œë”ë§</h3>
                    <div id="convertedRendering" style="background: #e8f5e8; padding: 15px; border: 1px solid #4caf50; border-radius: 4px; min-height: 100px; text-align: center;"></div>
                </div>
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <div id="conversionProgress" style="margin-bottom: 10px; font-weight: bold; color: #007bff;"></div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="approveConversion()" id="approveBtn" disabled>âœ… ìŠ¹ì¸</button>
                    <button class="btn btn-danger" onclick="rejectConversion()" id="rejectBtn" disabled>âŒ ê±°ë¶€</button>
                    <button class="btn btn-secondary" onclick="skipConversion()" id="skipBtn" disabled>â­ï¸ ê±´ë„ˆë›°ê¸°</button>
                    <button class="btn btn-info" onclick="regenerateConversion()" id="regenerateBtn" disabled>ğŸ”„ ì¬ìƒì„±</button>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeIndividualConversion()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- ì˜¤ë¦¬ì§€ë„ vs ë‰´ ë³€í™˜ ë¹„êµ ëª¨ë‹¬ -->
    <div id="comparisonModal" class="comparison-modal" style="display: none;">
        <div class="comparison-content">
            <div class="comparison-header">
                <h2>ğŸ” ì˜¤ë¦¬ì§€ë„ vs ë‰´ ë³€í™˜ ë¹„êµ</h2>
                <p>ë¬¸ì œ ID: <span id="comparisonProblemId">-</span></p>
            </div>
            <div class="comparison-body">
                <div class="comparison-panel">
                    <div class="panel-title">ğŸ“ mpcstudy.com ì˜¤ë¦¬ì§€ë„ (Wiris)</div>
                    <div class="panel-content">
                        <iframe id="originalIframe" class="original-iframe" src=""></iframe>
                    </div>
                </div>
                <div class="comparison-panel">
                    <div class="panel-title">ğŸ§ª ìƒˆë¡œìš´ ë³€í™˜ (MathJax + ChemDoodle)</div>
                    <div class="panel-content" id="newConversionContent">
                        <div class="loading">ìƒˆë¡œìš´ ë³€í™˜ ê²°ê³¼ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
            <div style="padding: 20px; text-align: center; border-top: 1px solid #ddd;">
                <button class="btn btn-secondary" onclick="closeComparison()">ë‹«ê¸°</button>
                <button class="btn btn-success" onclick="markAsCorrect()">ì •í™•í•¨</button>
                <button class="btn btn-danger" onclick="markAsError()">ì˜¤ë¥˜ ìˆìŒ</button>
            </div>
        </div>
    </div>
    
    <script>
        class DreamSeedEditor {
            constructor() {
                this.problemEditor = null;
                this.solutionEditor = null;
                this.init();
            }
            
            init() {
                // ì—ë””í„° ì´ˆê¸°í™”
                this.setupEventListeners();
                this.updateWordCount();
            }
            
            setupEventListeners() {
                const problemEditor = document.getElementById('problemEditor');
                const solutionEditor = document.getElementById('solutionEditor');
                
                // ì…ë ¥ ì´ë²¤íŠ¸
                problemEditor.addEventListener('input', () => {
                    this.updateWordCount();
                });
                
                solutionEditor.addEventListener('input', () => {
                    this.updateWordCount();
                });
                
                // ìˆ˜í•™ ì…ë ¥ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
                document.getElementById('mathInput').addEventListener('input', (e) => {
                    this.updateMathPreview(e.target.value);
                });
                
                // í™”í•™ ì…ë ¥ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
                document.getElementById('chemistryInput').addEventListener('input', (e) => {
                    this.updateChemistryPreview(e.target.value);
                });
            }
            
            updateWordCount() {
                const problemEditor = document.getElementById('problemEditor');
                const solutionEditor = document.getElementById('solutionEditor');
                
                const problemText = problemEditor.textContent || problemEditor.innerText || '';
                const solutionText = solutionEditor.textContent || solutionEditor.innerText || '';
                const totalText = problemText + ' ' + solutionText;
                
                const words = totalText.trim().split(/\s+/).filter(word => word.length > 0);
                const chars = totalText.length;
                
                document.getElementById('wordCount').textContent = `ë‹¨ì–´: ${words.length}`;
                document.getElementById('charCount').textContent = `ê¸€ì: ${chars}`;
            }
            
            updateMathPreview(latex) {
                const preview = document.getElementById('mathPreview');
                if (latex.trim()) {
                    preview.innerHTML = `$$${latex}$$`;
                    MathJax.typesetPromise([preview]);
                } else {
                    preview.innerHTML = 'ìˆ˜ì‹ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
                }
            }
            
            updateChemistryPreview(chemistry) {
                const preview = document.getElementById('chemistryPreview');
                if (chemistry.trim()) {
                    preview.innerHTML = `\\ce{${chemistry}}`;
                    MathJax.typesetPromise([preview]);
                } else {
                    preview.innerHTML = 'í™”í•™ ë°˜ì‘ì‹ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
                }
            }
            
            insertContent(content, type = 'html', targetEditor = 'problem') {
                const editor = document.getElementById(targetEditor === 'problem' ? 'problemEditor' : 'solutionEditor');
                const selection = window.getSelection();
                
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    
                    if (type === 'html') {
                        const div = document.createElement('div');
                        div.innerHTML = content;
                        range.insertNode(div.firstChild);
                    } else {
                        range.insertNode(document.createTextNode(content));
                    }
                    
                    // ì»¤ì„œë¥¼ ì‚½ì…ëœ ë‚´ìš© ë’¤ë¡œ ì´ë™
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    // ì„ íƒì´ ì—†ìœ¼ë©´ ì—ë””í„° ëì— ì‚½ì…
                    editor.innerHTML += content;
                }
                
                this.updateWordCount();
            }
        }
        
        // ì „ì—­ ë³€ìˆ˜
        let dreamSeedEditor;
        let conversionSettings = {
            apiKey: '',
            mode: 'mixed',
            batchSize: 10,
            target: 'both'
        };
        let conversionStats = {
            total: 0,
            converted: 0,
            errors: 0,
            startTime: null
        };
        
        // ê°œë³„ ë³€í™˜ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
        let currentMathMLList = [];
        let currentMathMLIndex = 0;
        let currentConvertedResult = '';
        
        // í”„ë¡œì íŠ¸ ì§„í–‰ë¥  ì¶”ì 
        let projectStats = {
            totalMathML: 47780,
            converted: 0,
            dailyGoal: 800,
            startDate: new Date(),
            dailyStats: {},
            weeklyStats: []
        };
        
        // ë¬¸ì œ ì†ì„± ë°ì´í„°
        let questionAttributes = {
            que_id: '',
            que_status: 1,
            que_class: 'M',
            que_category1: 0,
            que_category2: 0,
            que_category3: 0,
            que_grade: 'G09',
            que_level: 1,
            que_en_title: '',
            que_en_desc: '',
            que_en_hint: '',
            que_en_solution: '',
            que_en_answers: '',
            que_en_answerm: '',
            que_answertype: 0,
            que_en_example: '',
            que_en_resource: '',
            que_createddate: '',
            que_modifieddate: ''
        };
        
        // MathML ë³€í™˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function convertAllMathML() {
            if (!conversionSettings.apiKey) {
                alert('ë¨¼ì € ë³€í™˜ ì„¤ì •ì—ì„œ GPT-5 API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                openConversionModal();
                return;
            }
            
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            // MathML íƒœê·¸ ì°¾ê¸°
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            const totalMathML = problemMathML.length + solutionMathML.length;
            
            if (totalMathML === 0) {
                alert('ë³€í™˜í•  MathMLì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm(`${totalMathML}ê°œì˜ MathML íƒœê·¸ë¥¼ ì¼ê´„ ë³€í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                startBatchConversion(problemMathML, solutionMathML);
            }
        }
        
        function convertOneByOne() {
            if (!conversionSettings.apiKey) {
                alert('ë¨¼ì € ë³€í™˜ ì„¤ì •ì—ì„œ GPT-5 API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                openConversionModal();
                return;
            }
            
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            // MathML íƒœê·¸ ì°¾ê¸°
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            currentMathMLList = [...problemMathML, ...solutionMathML];
            currentMathMLIndex = 0;
            
            if (currentMathMLList.length === 0) {
                alert('ë³€í™˜í•  MathMLì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê°œë³„ ë³€í™˜ ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('individualConversionModal').style.display = 'block';
            processNextMathML();
        }
        
        async function processNextMathML() {
            if (currentMathMLIndex >= currentMathMLList.length) {
                alert('ëª¨ë“  MathML ë³€í™˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeIndividualConversion();
                return;
            }
            
            const currentMathML = currentMathMLList[currentMathMLIndex];
            
            // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            document.getElementById('conversionProgress').textContent = 
                `${currentMathMLIndex + 1} / ${currentMathMLList.length} - ë³€í™˜ ì¤‘...`;
            
            // ì›ë³¸ MathML í‘œì‹œ
            document.getElementById('originalMathML').textContent = currentMathML;
            
            // ì›ë³¸ ë Œë”ë§ (MathMLì„ ì§ì ‘ ë Œë”ë§)
            document.getElementById('originalRendering').innerHTML = currentMathML;
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('approveBtn').disabled = true;
            document.getElementById('rejectBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
            document.getElementById('regenerateBtn').disabled = true;
            
            try {
                // GPT-5ë¡œ ë³€í™˜
                currentConvertedResult = await convertSingleMathML(currentMathML);
                
                // ë³€í™˜ëœ ê²°ê³¼ í‘œì‹œ
                document.getElementById('convertedMathML').textContent = currentConvertedResult;
                
                // ë³€í™˜ëœ ë Œë”ë§ í‘œì‹œ
                document.getElementById('convertedRendering').innerHTML = currentConvertedResult;
                
                // MathJax ë Œë”ë§
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('convertedRendering')]);
                }
                
                // ë²„íŠ¼ í™œì„±í™”
                document.getElementById('approveBtn').disabled = false;
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
                
                document.getElementById('conversionProgress').textContent = 
                    `${currentMathMLIndex + 1} / ${currentMathMLList.length} - ë³€í™˜ ì™„ë£Œ (ê²€í†  í•„ìš”)`;
                
            } catch (error) {
                console.error('ë³€í™˜ ì˜¤ë¥˜:', error);
                document.getElementById('convertedMathML').textContent = 'ë³€í™˜ ì˜¤ë¥˜: ' + error.message;
                document.getElementById('convertedRendering').innerHTML = '<div class="error">ë³€í™˜ ì‹¤íŒ¨</div>';
                
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
            }
        }
        
        function approveConversion() {
            // í˜„ì¬ MathMLì„ ë³€í™˜ëœ ê²°ê³¼ë¡œ êµì²´
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            const currentMathML = currentMathMLList[currentMathMLIndex];
            
            // ë¬¸ì œ ì„¹ì…˜ì—ì„œ êµì²´
            if (problemContent.includes(currentMathML)) {
                const newProblemContent = problemContent.replace(currentMathML, currentConvertedResult);
                document.getElementById('problemEditor').innerHTML = newProblemContent;
            }
            
            // í•´ë‹µ ì„¹ì…˜ì—ì„œ êµì²´
            if (solutionContent.includes(currentMathML)) {
                const newSolutionContent = solutionContent.replace(currentMathML, currentConvertedResult);
                document.getElementById('solutionEditor').innerHTML = newSolutionContent;
            }
            
            // MathJax ì¬ë Œë”ë§
            if (window.MathJax) {
                MathJax.typesetPromise([document.getElementById('problemEditor'), document.getElementById('solutionEditor')]);
            }
            
            // í”„ë¡œì íŠ¸ í†µê³„ ì—…ë°ì´íŠ¸
            projectStats.converted++;
            const today = new Date().toDateString();
            projectStats.dailyStats[today] = (projectStats.dailyStats[today] || 0) + 1;
            updateProjectProgress();
            
            // ë‹¤ìŒìœ¼ë¡œ ì´ë™
            currentMathMLIndex++;
            processNextMathML();
        }
        
        function rejectConversion() {
            // ê±°ë¶€ëœ ë³€í™˜ì€ ê±´ë„ˆë›°ê¸°
            currentMathMLIndex++;
            processNextMathML();
        }
        
        function skipConversion() {
            // ê±´ë„ˆë›°ê¸°
            currentMathMLIndex++;
            processNextMathML();
        }
        
        async function regenerateConversion() {
            // ì¬ìƒì„±
            document.getElementById('conversionProgress').textContent = 
                `${currentMathMLIndex + 1} / ${currentMathMLList.length} - ì¬ìƒì„± ì¤‘...`;
            
            document.getElementById('approveBtn').disabled = true;
            document.getElementById('rejectBtn').disabled = true;
            document.getElementById('skipBtn').disabled = true;
            document.getElementById('regenerateBtn').disabled = true;
            
            try {
                const currentMathML = currentMathMLList[currentMathMLIndex];
                currentConvertedResult = await convertSingleMathML(currentMathML);
                
                document.getElementById('convertedMathML').textContent = currentConvertedResult;
                document.getElementById('convertedRendering').innerHTML = currentConvertedResult;
                
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('convertedRendering')]);
                }
                
                document.getElementById('approveBtn').disabled = false;
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
                
                document.getElementById('conversionProgress').textContent = 
                    `${currentMathMLIndex + 1} / ${currentMathMLList.length} - ì¬ìƒì„± ì™„ë£Œ (ê²€í†  í•„ìš”)`;
                
            } catch (error) {
                console.error('ì¬ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('convertedMathML').textContent = 'ì¬ìƒì„± ì˜¤ë¥˜: ' + error.message;
                document.getElementById('convertedRendering').innerHTML = '<div class="error">ì¬ìƒì„± ì‹¤íŒ¨</div>';
                
                document.getElementById('rejectBtn').disabled = false;
                document.getElementById('skipBtn').disabled = false;
                document.getElementById('regenerateBtn').disabled = false;
            }
        }
        
        function closeIndividualConversion() {
            document.getElementById('individualConversionModal').style.display = 'none';
            currentMathMLList = [];
            currentMathMLIndex = 0;
        }
        
        // ë°°ì¹˜ ë³€í™˜ í•¨ìˆ˜
        function convertBatch() {
            if (!conversionSettings.apiKey) {
                alert('ë¨¼ì € ë³€í™˜ ì„¤ì •ì—ì„œ GPT-5 API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                openConversionModal();
                return;
            }
            
            const batchSize = conversionSettings.batchSize || 10;
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            
            const mathmlRegex = /<math[^>]*>.*?<\/math>/gs;
            const problemMathML = problemContent.match(mathmlRegex) || [];
            const solutionMathML = solutionContent.match(mathmlRegex) || [];
            
            const totalMathML = problemMathML.length + solutionMathML.length;
            
            if (totalMathML === 0) {
                alert('ë³€í™˜í•  MathMLì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const batches = Math.ceil(totalMathML / batchSize);
            
            if (confirm(`${totalMathML}ê°œì˜ MathMLì„ ${batches}ê°œ ë°°ì¹˜ë¡œ ë‚˜ëˆ„ì–´ ë³€í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në°°ì¹˜ í¬ê¸°: ${batchSize}ê°œ`)) {
                startBatchProcessing(problemMathML, solutionMathML, batchSize);
            }
        }
        
        async function startBatchProcessing(problemMathML, solutionMathML, batchSize) {
            const allMathML = [...problemMathML, ...solutionMathML];
            const batches = [];
            
            for (let i = 0; i < allMathML.length; i += batchSize) {
                batches.push(allMathML.slice(i, i + batchSize));
            }
            
            for (let batchIndex = 0; batchIndex < batches.length; batchIndex++) {
                const batch = batches[batchIndex];
                console.log(`ë°°ì¹˜ ${batchIndex + 1}/${batches.length} ì²˜ë¦¬ ì¤‘... (${batch.length}ê°œ)`);
                
                // ë°°ì¹˜ë³„ë¡œ ë³€í™˜
                for (const mathml of batch) {
                    try {
                        const converted = await convertSingleMathML(mathml);
                        
                        // ë¬¸ì œ ì„¹ì…˜ì—ì„œ êµì²´
                        if (problemMathML.includes(mathml)) {
                            const newContent = document.getElementById('problemEditor').innerHTML.replace(mathml, converted);
                            document.getElementById('problemEditor').innerHTML = newContent;
                        }
                        
                        // í•´ë‹µ ì„¹ì…˜ì—ì„œ êµì²´
                        if (solutionMathML.includes(mathml)) {
                            const newContent = document.getElementById('solutionEditor').innerHTML.replace(mathml, converted);
                            document.getElementById('solutionEditor').innerHTML = newContent;
                        }
                        
                        projectStats.converted++;
                        updateProjectProgress();
                        
                    } catch (error) {
                        console.error('ë°°ì¹˜ ë³€í™˜ ì˜¤ë¥˜:', error);
                    }
                }
                
                // MathJax ì¬ë Œë”ë§
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('problemEditor'), document.getElementById('solutionEditor')]);
                }
                
                // ë°°ì¹˜ ê°„ ì ì‹œ ëŒ€ê¸° (API ì œí•œ ê³ ë ¤)
                if (batchIndex < batches.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            alert(`ë°°ì¹˜ ë³€í™˜ ì™„ë£Œ!\nì´ ${projectStats.converted}ê°œ ë³€í™˜ ì„±ê³µ`);
        }
        
        // í”„ë¡œì íŠ¸ ì§„í–‰ë¥  í‘œì‹œ
        function showProjectProgress() {
            updateProjectProgress();
            document.getElementById('projectProgressModal').style.display = 'block';
        }
        
        function updateProjectProgress() {
            const percentage = Math.round((projectStats.converted / projectStats.totalMathML) * 100);
            
            document.getElementById('convertedCount').textContent = projectStats.converted.toLocaleString();
            document.getElementById('mathmlPercentage').textContent = percentage + '%';
            document.getElementById('mathmlProgressBar').style.width = percentage + '%';
            
            // ì˜ˆìƒ ì™„ë£Œ ì‹œê°„ ê³„ì‚°
            const remaining = projectStats.totalMathML - projectStats.converted;
            const daysRemaining = Math.ceil(remaining / projectStats.dailyGoal);
            const completionDate = new Date();
            completionDate.setDate(completionDate.getDate() + daysRemaining);
            
            document.getElementById('estimatedCompletion').textContent = 
                completionDate.toLocaleDateString() + ` (${daysRemaining}ì¼ í›„)`;
            
            // í˜„ì¬ ì†ë„ ê³„ì‚° (ìµœê·¼ 7ì¼ í‰ê· )
            const today = new Date().toDateString();
            const todayConverted = projectStats.dailyStats[today] || 0;
            document.getElementById('todayConverted').textContent = todayConverted;
            
            // ì£¼ê°„ í‰ê·  ê³„ì‚°
            const weeklyTotal = Object.values(projectStats.dailyStats).reduce((sum, count) => sum + count, 0);
            const weeklyAverage = Math.round(weeklyTotal / 7);
            document.getElementById('weeklyAverage').textContent = weeklyAverage;
            
            // ì—°ì† ì‘ì—…ì¼ ê³„ì‚°
            const consecutiveDays = calculateConsecutiveDays();
            document.getElementById('consecutiveDays').textContent = consecutiveDays;
            
            // í†µê³„ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('projectStats', JSON.stringify(projectStats));
        }
        
        function calculateConsecutiveDays() {
            const today = new Date();
            let consecutive = 0;
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toDateString();
                
                if (projectStats.dailyStats[dateString] && projectStats.dailyStats[dateString] > 0) {
                    consecutive++;
                } else {
                    break;
                }
            }
            
            return consecutive;
        }
        
        function exportProgress() {
            const progressData = {
                totalMathML: projectStats.totalMathML,
                converted: projectStats.converted,
                percentage: Math.round((projectStats.converted / projectStats.totalMathML) * 100),
                dailyStats: projectStats.dailyStats,
                lastUpdated: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `dreamseed_progress_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }
        
        // ë¬¸ì œ ì†ì„± ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openAttributeModal() {
            // í˜„ì¬ ì†ì„± ë°ì´í„°ë¥¼ ëª¨ë‹¬ì— ë¡œë“œ
            loadAttributesToModal();
            document.getElementById('attributeModal').style.display = 'block';
        }
        
        function loadAttributesToModal() {
            document.getElementById('attrSubject').value = questionAttributes.que_class || 'M';
            document.getElementById('attrGrade').value = questionAttributes.que_grade || 'G09';
            document.getElementById('attrLevel').value = questionAttributes.que_level || 1;
            document.getElementById('attrStatus').value = questionAttributes.que_status || 1;
            document.getElementById('attrCategory1').value = questionAttributes.que_category1 || 0;
            document.getElementById('attrCategory2').value = questionAttributes.que_category2 || 0;
            document.getElementById('attrCategory3').value = questionAttributes.que_category3 || 0;
            document.getElementById('attrAnswerType').value = questionAttributes.que_answertype || 0;
            document.getElementById('attrTitle').value = questionAttributes.que_en_title || '';
            document.getElementById('attrDescription').value = questionAttributes.que_en_desc || '';
            document.getElementById('attrHint').value = questionAttributes.que_en_hint || '';
            document.getElementById('attrExample').value = questionAttributes.que_en_example || '';
        }
        
        function saveAttributes() {
            // ëª¨ë‹¬ì—ì„œ ì†ì„± ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ì €ì¥
            questionAttributes.que_class = document.getElementById('attrSubject').value;
            questionAttributes.que_grade = document.getElementById('attrGrade').value;
            questionAttributes.que_level = parseInt(document.getElementById('attrLevel').value);
            questionAttributes.que_status = parseInt(document.getElementById('attrStatus').value);
            questionAttributes.que_category1 = parseInt(document.getElementById('attrCategory1').value) || 0;
            questionAttributes.que_category2 = parseInt(document.getElementById('attrCategory2').value) || 0;
            questionAttributes.que_category3 = parseInt(document.getElementById('attrCategory3').value) || 0;
            questionAttributes.que_answertype = parseInt(document.getElementById('attrAnswerType').value);
            questionAttributes.que_en_title = document.getElementById('attrTitle').value;
            questionAttributes.que_en_desc = document.getElementById('attrDescription').value;
            questionAttributes.que_en_hint = document.getElementById('attrHint').value;
            questionAttributes.que_en_example = document.getElementById('attrExample').value;
            questionAttributes.que_modifieddate = new Date().toISOString().replace('T', '').split('.')[0];
            
            // ì†ì„± íŒ¨ë„ ì—…ë°ì´íŠ¸
            updateAttributesDisplay();
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('questionAttributes', JSON.stringify(questionAttributes));
            
            alert('ë¬¸ì œ ì†ì„±ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal('attributeModal');
        }
        
        function updateAttributesDisplay() {
            const attributesList = document.getElementById('attributesList');
            const attributesPanel = document.getElementById('questionAttributes');
            
            // ê¸°ì¡´ íƒœê·¸ë“¤ ì œê±°
            attributesList.innerHTML = '';
            
            // ì†ì„± íƒœê·¸ë“¤ ìƒì„±
            const tags = [
                { label: 'ê³¼ëª©', value: getSubjectName(questionAttributes.que_class), color: '#007bff' },
                { label: 'í•™ë…„', value: questionAttributes.que_grade, color: '#28a745' },
                { label: 'ë‚œì´ë„', value: `${questionAttributes.que_level}ë‹¨ê³„`, color: '#ffc107' },
                { label: 'ìƒíƒœ', value: questionAttributes.que_status ? 'í™œì„±' : 'ë¹„í™œì„±', color: questionAttributes.que_status ? '#28a745' : '#dc3545' },
                { label: 'ì¹´í…Œê³ ë¦¬1', value: questionAttributes.que_category1, color: '#6f42c1' },
                { label: 'ì¹´í…Œê³ ë¦¬2', value: questionAttributes.que_category2, color: '#6f42c1' },
                { label: 'ì¹´í…Œê³ ë¦¬3', value: questionAttributes.que_category3, color: '#6f42c1' },
                { label: 'ë‹µë³€ìœ í˜•', value: getAnswerTypeName(questionAttributes.que_answertype), color: '#17a2b8' }
            ];
            
            tags.forEach(tag => {
                if (tag.value && tag.value !== '0' && tag.value !== '') {
                    const tagElement = document.createElement('span');
                    tagElement.style.cssText = `
                        background: ${tag.color};
                        color: white;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                        font-weight: 500;
                        display: inline-block;
                        margin: 2px;
                    `;
                    tagElement.textContent = `${tag.label}: ${tag.value}`;
                    attributesList.appendChild(tagElement);
                }
            });
            
            // ì†ì„± íŒ¨ë„ í‘œì‹œ
            attributesPanel.style.display = 'block';
        }
        
        function getSubjectName(code) {
            const subjects = {
                'M': 'ìˆ˜í•™',
                'P': 'ë¬¼ë¦¬',
                'C': 'í™”í•™',
                'B': 'ìƒë¬¼'
            };
            return subjects[code] || code;
        }
        
        function getAnswerTypeName(type) {
            const types = {
                0: 'ê°ê´€ì‹',
                1: 'ì£¼ê´€ì‹',
                2: 'ì„œìˆ í˜•'
            };
            return types[type] || type;
        }
        
        function loadFromDatabase() {
            const problemId = document.getElementById('problemId').value;
            if (!problemId.trim()) {
                alert('ë¬¸ì œ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¬¸ì œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
            // ì—¬ê¸°ì„œëŠ” ìƒ˜í”Œ ë°ì´í„°ë¡œ ì‹œë®¬ë ˆì´ì…˜
            const sampleData = {
                que_id: problemId,
                que_status: 1,
                que_class: 'M',
                que_category1: 663,
                que_category2: 0,
                que_category3: 0,
                que_grade: 'G09',
                que_level: 3,
                que_en_title: 'Calculation bases on weight-weight relationship',
                que_en_desc: 'What is the amount of NH3 formed when 14 g of N2 combines with 6 g of H2?',
                que_en_hint: 'Use stoichiometry to solve this problem',
                que_en_solution: 'Solution will be loaded from database...',
                que_en_answers: '',
                que_en_answerm: '',
                que_answertype: 0,
                que_en_example: '',
                que_en_resource: '',
                que_createddate: '20191207103340',
                que_modifieddate: '20221009173006'
            };
            
            // ì†ì„± ë°ì´í„° ì—…ë°ì´íŠ¸
            questionAttributes = { ...questionAttributes, ...sampleData };
            
            // ëª¨ë‹¬ì— ë¡œë“œ
            loadAttributesToModal();
            
            alert('ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¬¸ì œ ì •ë³´ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
        }
        
        async function startBatchConversion(problemMathML, solutionMathML) {
            conversionStats = {
                total: problemMathML.length + solutionMathML.length,
                converted: 0,
                errors: 0,
                startTime: new Date()
            };
            
            try {
                // ë¬¸ì œ ì„¹ì…˜ ë³€í™˜
                if (conversionSettings.target === 'both' || conversionSettings.target === 'problem') {
                    await convertMathMLInEditor('problemEditor', problemMathML);
                }
                
                // í•´ë‹µ ì„¹ì…˜ ë³€í™˜
                if (conversionSettings.target === 'both' || conversionSettings.target === 'solution') {
                    await convertMathMLInEditor('solutionEditor', solutionMathML);
                }
                
                // ë³€í™˜ ì™„ë£Œ ì•Œë¦¼
                const elapsed = Math.round((new Date() - conversionStats.startTime) / 1000);
                alert(`ë³€í™˜ ì™„ë£Œ!\nì´ ${conversionStats.total}ê°œ ì¤‘ ${conversionStats.converted}ê°œ ë³€í™˜ ì„±ê³µ\nì˜¤ë¥˜: ${conversionStats.errors}ê°œ\nì†Œìš” ì‹œê°„: ${elapsed}ì´ˆ`);
                
            } catch (error) {
                console.error('ë³€í™˜ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        async function convertMathMLInEditor(editorId, mathmlArray) {
            const editor = document.getElementById(editorId);
            let content = editor.innerHTML;
            
            for (const mathml of mathmlArray) {
                try {
                    const converted = await convertSingleMathML(mathml);
                    content = content.replace(mathml, converted);
                    conversionStats.converted++;
                } catch (error) {
                    console.error('MathML ë³€í™˜ ì˜¤ë¥˜:', error);
                    conversionStats.errors++;
                }
            }
            
            editor.innerHTML = content;
            
            // MathJax ì¬ë Œë”ë§
            if (window.MathJax) {
                MathJax.typesetPromise([editor]);
            }
        }
        
        async function convertSingleMathML(mathml) {
            const prompt = createConversionPrompt(mathml);
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${conversionSettings.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-5',
                    messages: [
                        {
                            role: 'system',
                            content: 'ë‹¹ì‹ ì€ MathMLì„ MathJax/ChemDoodle í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì •í™•í•˜ê³  ê¹”ë”í•œ ë³€í™˜ì„ ì œê³µí•˜ì„¸ìš”.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.1
                })
            });
            
            if (!response.ok) {
                throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }
        
        function createConversionPrompt(mathml) {
            const mode = conversionSettings.mode;
            
            let systemPrompt = '';
            if (mode === 'math') {
                systemPrompt = 'ì´ MathMLì„ MathJax LaTeX í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”. ìˆ˜í•™ ìˆ˜ì‹ì—ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”.';
            } else if (mode === 'chemistry') {
                systemPrompt = 'ì´ MathMLì„ ChemDoodle í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”. í™”í•™ êµ¬ì¡°ì‹ê³¼ ë°˜ì‘ì‹ì— ì§‘ì¤‘í•˜ì„¸ìš”.';
            } else {
                systemPrompt = 'ì´ MathMLì„ MathJax (ìˆ˜í•™) ë˜ëŠ” ChemDoodle (í™”í•™) í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”. ë‚´ìš©ì— ë”°ë¼ ì ì ˆí•œ í˜•ì‹ì„ ì„ íƒí•˜ì„¸ìš”.';
            }
            
            return `${systemPrompt}\n\nMathML:\n${mathml}\n\në³€í™˜ëœ ê²°ê³¼ë§Œ ë°˜í™˜í•˜ì„¸ìš”:`;
        }
        
        function openConversionModal() {
            // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
            document.getElementById('gptApiKey').value = conversionSettings.apiKey;
            document.getElementById('conversionMode').value = conversionSettings.mode;
            document.getElementById('batchSize').value = conversionSettings.batchSize;
            document.getElementById('conversionTarget').value = conversionSettings.target;
            
            document.getElementById('conversionModal').style.display = 'block';
        }
        
        function saveConversionSettings() {
            conversionSettings.apiKey = document.getElementById('gptApiKey').value;
            conversionSettings.mode = document.getElementById('conversionMode').value;
            conversionSettings.batchSize = parseInt(document.getElementById('batchSize').value);
            conversionSettings.target = document.getElementById('conversionTarget').value;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('conversionSettings', JSON.stringify(conversionSettings));
            
            alert('ë³€í™˜ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal('conversionModal');
        }
        
        function showConversionStatus() {
            const statusDiv = document.getElementById('conversionStatus');
            
            if (conversionStats.startTime) {
                const elapsed = Math.round((new Date() - conversionStats.startTime) / 1000);
                const progress = conversionStats.total > 0 ? (conversionStats.converted / conversionStats.total * 100).toFixed(1) : 0;
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <h3>ë³€í™˜ í†µê³„</h3>
                        <p><strong>ì´ MathML:</strong> ${conversionStats.total}ê°œ</p>
                        <p><strong>ë³€í™˜ ì™„ë£Œ:</strong> ${conversionStats.converted}ê°œ</p>
                        <p><strong>ì˜¤ë¥˜:</strong> ${conversionStats.errors}ê°œ</p>
                        <p><strong>ì§„í–‰ë¥ :</strong> ${progress}%</p>
                        <p><strong>ì†Œìš” ì‹œê°„:</strong> ${elapsed}ì´ˆ</p>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = '<div class="error">ì•„ì§ ë³€í™˜ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
            }
            
            document.getElementById('statusModal').style.display = 'block';
        }
        
        function refreshStatus() {
            showConversionStatus();
        }
        
        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openMathModal() {
            document.getElementById('mathModal').style.display = 'block';
            document.getElementById('mathInput').focus();
        }
        
        function openChemistryModal() {
            document.getElementById('chemistryModal').style.display = 'block';
            document.getElementById('chemistryInput').focus();
        }
        
        function openBenzeneModal() {
            document.getElementById('benzeneModal').style.display = 'block';
            createBenzeneStructure();
        }
        
        function openNaphthaleneModal() {
            document.getElementById('naphthaleneModal').style.display = 'block';
            createNaphthaleneStructure();
        }
        
        function openSteroidModal() {
            document.getElementById('steroidModal').style.display = 'block';
            createSteroidStructure();
        }
        
        function openLinkModal() {
            document.getElementById('linkModal').style.display = 'block';
            document.getElementById('linkText').focus();
        }
        
        function openImageModal() {
            document.getElementById('imageModal').style.display = 'block';
            document.getElementById('imageUrl').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // ìˆ˜ì‹ ì‚½ì…
        function insertMath() {
            const mathInput = document.getElementById('mathInput').value;
            if (mathInput.trim()) {
                const mathContent = `<div class="math-content">$$${mathInput}$$</div>`;
                dreamSeedEditor.insertContent(mathContent, 'html', 'problem');
                closeModal('mathModal');
                document.getElementById('mathInput').value = '';
            }
        }
        
        // í™”í•™ ë°˜ì‘ì‹ ì‚½ì…
        function insertChemistry() {
            const chemistryInput = document.getElementById('chemistryInput').value;
            if (chemistryInput.trim()) {
                const chemistryContent = `<div class="chemistry-content">\\ce{${chemistryInput}}</div>`;
                dreamSeedEditor.insertContent(chemistryContent, 'html', 'problem');
                closeModal('chemistryModal');
                document.getElementById('chemistryInput').value = '';
            }
        }
        
        // ë²¤ì   ê³ ë¦¬ ì‚½ì…
        function insertBenzene() {
            const benzeneContent = `<div class="chemistry-content" data-type="benzene">ë²¤ì   ê³ ë¦¬ (Câ‚†Hâ‚†)</div>`;
            dreamSeedEditor.insertContent(benzeneContent, 'html', 'problem');
            closeModal('benzeneModal');
        }
        
        // ë‚˜í”„íƒˆë Œ ì‚½ì…
        function insertNaphthalene() {
            const naphthaleneContent = `<div class="chemistry-content" data-type="naphthalene">ë‚˜í”„íƒˆë Œ (Câ‚â‚€Hâ‚ˆ)</div>`;
            dreamSeedEditor.insertContent(naphthaleneContent, 'html', 'problem');
            closeModal('naphthaleneModal');
        }
        
        // ìŠ¤í…Œë¡œì´ë“œ ì‚½ì…
        function insertSteroid() {
            const steroidContent = `<div class="chemistry-content" data-type="steroid">ìŠ¤í…Œë¡œì´ë“œ êµ¬ì¡°</div>`;
            dreamSeedEditor.insertContent(steroidContent, 'html', 'problem');
            closeModal('steroidModal');
        }
        
        // ë§í¬ ì‚½ì…
        function insertLink() {
            const linkText = document.getElementById('linkText').value;
            const linkUrl = document.getElementById('linkUrl').value;
            
            if (linkText && linkUrl) {
                const linkContent = `<a href="${linkUrl}" target="_blank">${linkText}</a>`;
                dreamSeedEditor.insertContent(linkContent, 'html', 'problem');
                closeModal('linkModal');
                document.getElementById('linkText').value = '';
                document.getElementById('linkUrl').value = '';
            }
        }
        
        // ì´ë¯¸ì§€ ì‚½ì…
        function insertImage() {
            const imageUrl = document.getElementById('imageUrl').value;
            const imageAlt = document.getElementById('imageAlt').value;
            
            if (imageUrl) {
                const imageContent = `<img src="${imageUrl}" alt="${imageAlt || ''}" style="max-width: 100%; height: auto;">`;
                dreamSeedEditor.insertContent(imageContent, 'html', 'problem');
                closeModal('imageModal');
                document.getElementById('imageUrl').value = '';
                document.getElementById('imageAlt').value = '';
            }
        }
        
        // ChemDoodle êµ¬ì¡° ìƒì„±
        function createBenzeneStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('benzeneCanvas', 300, 200);
                const benzene = new ChemDoodle.Molecule();
                
                // ë²¤ì   ê³ ë¦¬ ì›ìë“¤
                const atoms = [
                    new ChemDoodle.Atom(0, 100, 0, 'C'),
                    new ChemDoodle.Atom(87, 50, 0, 'C'),
                    new ChemDoodle.Atom(87, -50, 0, 'C'),
                    new ChemDoodle.Atom(0, -100, 0, 'C'),
                    new ChemDoodle.Atom(-87, -50, 0, 'C'),
                    new ChemDoodle.Atom(-87, 50, 0, 'C')
                ];
                
                atoms.forEach(atom => benzene.addAtom(atom));
                
                // ë²¤ì   ê³ ë¦¬ ê²°í•©ë“¤
                const bonds = [
                    new ChemDoodle.Bond(0, 1, 1),
                    new ChemDoodle.Bond(1, 2, 2),
                    new ChemDoodle.Bond(2, 3, 1),
                    new ChemDoodle.Bond(3, 4, 2),
                    new ChemDoodle.Bond(4, 5, 1),
                    new ChemDoodle.Bond(5, 0, 2)
                ];
                
                bonds.forEach(bond => benzene.addBond(bond));
                canvas.loadMolecule(benzene);
            }
        }
        
        function createNaphthaleneStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('naphthaleneCanvas', 300, 200);
                // ë‚˜í”„íƒˆë Œ êµ¬ì¡° ìƒì„± ë¡œì§
                const naphthalene = new ChemDoodle.Molecule();
                canvas.loadMolecule(naphthalene);
            }
        }
        
        function createSteroidStructure() {
            if (window.ChemDoodle) {
                const canvas = new ChemDoodle.SketchCanvas('steroidCanvas', 300, 200);
                // ìŠ¤í…Œë¡œì´ë“œ êµ¬ì¡° ìƒì„± ë¡œì§
                const steroid = new ChemDoodle.Molecule();
                canvas.loadMolecule(steroid);
            }
        }
        
        // ê¸°ë³¸ ì„œì‹ í•¨ìˆ˜ë“¤
        function toggleFormat(format) {
            document.execCommand(format);
        }
        
        function setHeading(level) {
            document.execCommand('formatBlock', false, `h${level}`);
        }
        
        function toggleList(listType) {
            document.execCommand(listType);
        }
        
        function toggleBlockquote() {
            document.execCommand('formatBlock', false, 'blockquote');
        }
        
        function toggleCode() {
            document.execCommand('formatBlock', false, 'pre');
        }
        
        function setAlignment(align) {
            document.execCommand('justify' + align.charAt(0).toUpperCase() + align.slice(1));
        }
        
        // ì—ë””í„° ì•¡ì…˜ í•¨ìˆ˜ë“¤
        function clearProblem() {
            if (confirm('ë¬¸ì œ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('problemEditor').innerHTML = '<p>ë¬¸ì œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</p>';
                dreamSeedEditor.updateWordCount();
            }
        }
        
        function clearSolution() {
            if (confirm('í•´ë‹µ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('solutionEditor').innerHTML = '<p>í•´ë‹µ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</p>';
                dreamSeedEditor.updateWordCount();
            }
        }
        
        function previewContent() {
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ë¯¸ë¦¬ë³´ê¸°</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .math-content { background: #fff3e0; padding: 10px; margin: 10px 0; }
                        .chemistry-content { background: #f3e5f5; padding: 10px; margin: 10px 0; }
                        .problem-section { border: 2px solid #007bff; padding: 20px; margin-bottom: 20px; }
                        .solution-section { border: 2px solid #28a745; padding: 20px; }
                    </style>
                </head>
                <body>
                    <div class="problem-section">
                        <h2>ğŸ“ Problem Section</h2>
                        ${problemContent}
                    </div>
                    <div class="solution-section">
                        <h2>ğŸ’¡ Solution Section</h2>
                        ${solutionContent}
                    </div>
                </body>
                </html>
            `);
        }
        
        function saveContent() {
            const problemContent = document.getElementById('problemEditor').innerHTML;
            const solutionContent = document.getElementById('solutionEditor').innerHTML;
            console.log('ì €ì¥í•  ë¬¸ì œ ë‚´ìš©:', problemContent);
            console.log('ì €ì¥í•  í•´ë‹µ ë‚´ìš©:', solutionContent);
            alert('ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ì½˜ì†”ì—ì„œ í™•ì¸)');
        }
        
        // ë¬¸ì œ ë¡œë“œ í•¨ìˆ˜
        function loadProblem() {
            const problemId = document.getElementById('problemId').value;
            if (problemId.trim()) {
                // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œë¡œ ë¬¸ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                const mockProblem = `
                    <h3>ë¬¸ì œ ${problemId}</h3>
                    <p>ë‹¤ìŒ ìˆ˜ì‹ì„ ê³„ì‚°í•˜ì‹œì˜¤:</p>
                    <div class="math-content">$$\\int_0^1 x^2 dx$$</div>
                    <p>í™”í•™ ë°˜ì‘ì‹ì„ ì‘ì„±í•˜ì‹œì˜¤:</p>
                    <div class="chemistry-content">\\ce{2H2 + O2 -> 2H2O}</div>
                `;
                document.getElementById('problemEditor').innerHTML = mockProblem;
                dreamSeedEditor.updateWordCount();
            } else {
                alert('ë¬¸ì œ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì˜¤ë¦¬ì§€ë„ ë¹„êµ í•¨ìˆ˜
        function compareWithOriginal() {
            const problemId = document.getElementById('problemId').value;
            if (problemId.trim()) {
                document.getElementById('comparisonProblemId').textContent = problemId;
                document.getElementById('originalIframe').src = `https://mpcstudy.com/admin/index.php?view=question_info&que_id=${problemId}`;
                
                // ìƒˆë¡œìš´ ë³€í™˜ ê²°ê³¼ ì‹œë®¬ë ˆì´ì…˜
                const newConversionContent = `
                    <h3>ìƒˆë¡œìš´ ë³€í™˜ ê²°ê³¼ (MathJax + ChemDoodle)</h3>
                    <div class="math-content">$$\\int_0^1 x^2 dx = \\frac{1}{3}$$</div>
                    <div class="chemistry-content">\\ce{2H2 + O2 -> 2H2O}</div>
                    <p>ì´ ë³€í™˜ì€ MathJaxì™€ ChemDoodleì„ ì‚¬ìš©í•˜ì—¬ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                `;
                document.getElementById('newConversionContent').innerHTML = newConversionContent;
                
                // MathJax ë Œë”ë§
                MathJax.typesetPromise([document.getElementById('newConversionContent')]);
                
                document.getElementById('comparisonModal').style.display = 'block';
            } else {
                alert('ë¬¸ì œ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ë¹„êµ ëª¨ë‹¬ ë‹«ê¸°
        function closeComparison() {
            document.getElementById('comparisonModal').style.display = 'none';
        }
        
        // ì •í™•í•¨ í‘œì‹œ
        function markAsCorrect() {
            const problemId = document.getElementById('comparisonProblemId').textContent;
            alert(`ë¬¸ì œ ${problemId}ê°€ ì •í™•í•˜ë‹¤ê³  í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            closeComparison();
        }
        
        // ì˜¤ë¥˜ ìˆìŒ í‘œì‹œ
        function markAsError() {
            const problemId = document.getElementById('comparisonProblemId').textContent;
            alert(`ë¬¸ì œ ${problemId}ì— ì˜¤ë¥˜ê°€ ìˆë‹¤ê³  í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            closeComparison();
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal, .comparison-modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            dreamSeedEditor = new DreamSeedEditor();
            
            // ì €ì¥ëœ ë³€í™˜ ì„¤ì • ë¡œë“œ
            const savedSettings = localStorage.getItem('conversionSettings');
            if (savedSettings) {
                conversionSettings = { ...conversionSettings, ...JSON.parse(savedSettings) };
            }
            
            // ì €ì¥ëœ í”„ë¡œì íŠ¸ í†µê³„ ë¡œë“œ
            const savedStats = localStorage.getItem('projectStats');
            if (savedStats) {
                const loadedStats = JSON.parse(savedStats);
                projectStats = { ...projectStats, ...loadedStats };
                // ë‚ ì§œ ê°ì²´ ë³µì›
                if (loadedStats.startDate) {
                    projectStats.startDate = new Date(loadedStats.startDate);
                }
            }
            
            // ì €ì¥ëœ ë¬¸ì œ ì†ì„± ë¡œë“œ
            const savedAttributes = localStorage.getItem('questionAttributes');
            if (savedAttributes) {
                questionAttributes = { ...questionAttributes, ...JSON.parse(savedAttributes) };
                updateAttributesDisplay();
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateProjectProgress();
        });
    </script>
</body>
</html>
